!function(e,t){"use strict";class s extends t.Texture{constructor(e){super(e)}getImage(){return{width:this.sourceWidth,height:this.sourceHeight}}setFilters(e,t){}setWraps(e,t){}}class i extends spine.AssetManager{constructor(e="",t,i){super((e,t)=>i[t]=new s(e.bitmap),e,t)}}var n=spine.Color,a=spine.SkeletonClipping,r=spine.Vector2,l=spine.Utils,h=spine.RegionAttachment,o=spine.MeshAttachment,u=spine.ClippingAttachment;class p{constructor(e,t,s){this.vertices=e,this.numVertices=t,this.numFloats=s}}class d{constructor(e=!0){this.vertexEffect=null,this.tempColor=new n,this.tempColor2=new n,this.vertexSize=8,this.twoColorTint=!1,this.renderable=new p(null,0,0),this.clipper=new a,this.temp=new r,this.temp2=new r,this.temp3=new n,this.temp4=new n,this.twoColorTint=e,e&&(this.vertexSize+=4),this.vertices=l.newFloatArray(1024*this.vertexSize)}draw(e,s=-1,i=-1,n,a){let r=this.clipper,p=this.premultipliedAlpha,m=this.temp,c=this.temp2,g=this.temp3,y=this.temp4,_=this.renderable,S=null,k=null,A=e.drawOrder,x=null,f=e.color,v=!1;-1==s&&(v=!0);for(let e=0,w=A.length;e<w;e++){let w=r.isClipping()?2:8,E=A[e];if(s>=0&&s==E.data.index&&(v=!0),!v){r.clipEndWithSlot(E);continue}i>=0&&i==E.data.index&&(v=!1);let b,D=E.getAttachment(),B=null;if(D instanceof h){let e=D;_.vertices=this.vertices,_.numVertices=4,_.numFloats=w<<2,e.computeWorldVertices(E.bone,_.vertices,0,w),k=d.QUAD_TRIANGLES,S=e.uvs,B=e.region.renderObject.page.name,b=a[B],x=e.color}else{if(!(D instanceof o)){if(D instanceof u){let e=D;r.clipStart(E,e);continue}r.clipEndWithSlot(E);continue}{let e=D;_.vertices=this.vertices,_.numVertices=e.worldVerticesLength>>1,_.numFloats=_.numVertices*w,_.numFloats>_.vertices.length&&(_.vertices=this.vertices=l.newFloatArray(_.numFloats)),e.computeWorldVertices(E,0,e.worldVerticesLength,_.vertices,0,w),k=e.triangles,B=e.region.renderObject.page.name,b=a[B],S=e.uvs,x=e.color}}if(null!=b){let e=E.color,s=this.tempColor;s.r=f.r*e.r*x.r,s.g=f.g*e.g*x.g,s.b=f.b*e.b*x.b,s.a=f.a*e.a*x.a,p&&(s.r*=s.a,s.g*=s.a,s.b*=s.a);let i=E.data.blendMode;if(r.isClipping()){r.clipTriangles(_.vertices,_.numFloats,k,k.length,S,s,null,!1);let e=new Float32Array(r.clippedVertices),a=r.clippedTriangles,l=[],h=[],o=[];if(null!=this.vertexEffect){let t=this.vertexEffect,s=e;for(let i=0,n=e.length;i<n;i+=8)m.x=s[i],m.y=s[i+1],g.set(s[i+2],s[i+3],s[i+4],s[i+5]),c.x=s[i+6],c.y=s[i+7],y.set(0,0,0,0),t.transform(m,c,g,y),s[i]=m.x,s[i+1]=m.y,s[i+2]=g.r,s[i+3]=g.g,s[i+4]=g.b,s[i+5]=g.a,s[i+6]=c.x,s[i+7]=c.y,l.push(s[i],-s[i+1]),o.push(s[i+2],s[i+3],s[i+4],s[i+5]),h.push(s[i+6],s[i+7])}else{let t=0;for(;Number.isFinite(e[t+6])&&Number.isFinite(e[t+7]);)l.push(e[t]),l.push(-e[t+1]),o.push(e[t+2]),o.push(e[t+3]),o.push(e[t+4]),o.push(e[t+5]),h.push(e[t+6]),h.push(e[t+7]),t+=this.vertexSize}let u,p=null,d=null;switch(i){case 1:u="light";break;case 2:u="multiply";break;case 3:u="screen";break;default:u="normal"}d=(255<<24)+255*o[0]|0+(255*o[1]<<8)+(255*o[2]<<16),n.graphics.drawTriangles(b,0,0,l,h,new Uint16Array(a),t.Matrix.EMPTY,o[3],p,u,d)}else{let e=_.vertices,a=[],r=[],l=[];if(null!=this.vertexEffect){let t=this.vertexEffect;for(let i=0,n=0,h=_.numFloats;i<h;i+=8,n+=2)m.x=e[i],m.y=e[i+1],c.x=S[n],c.y=S[n+1],g.setFromColor(s),y.set(0,0,0,0),t.transform(m,c,g,y),e[i]=m.x,e[i+1]=m.y,e[i+2]=g.r,e[i+3]=g.g,e[i+4]=g.b,e[i+5]=g.a,e[i+6]=c.x,e[i+7]=c.y,a.push(e[i],-e[i+1]),l.push(e[i+2],e[i+3],e[i+4],e[i+5]),r.push(e[i+6],e[i+7])}else for(let t=2,i=0,n=_.numFloats;t<n;t+=8,i+=2)e[t]=s.r,e[t+1]=s.g,e[t+2]=s.b,e[t+3]=s.a,e[t+4]=S[i],e[t+5]=S[i+1],a.push(e[t-2],-e[t-1]),l.push(e[t],e[t+1],e[t+2],e[t+3]),r.push(e[t+4],e[t+5]);let h,o=null,u=null;switch(i){case 1:h="light";break;case 2:h="multiply";break;case 3:h="screen";break;default:h="normal"}u=(255<<24)+255*l[0]|0+(255*l[1]<<8)+(255*l[2]<<16),n.graphics.drawTriangles(b,0,0,a,r,new Uint16Array(k),t.Matrix.EMPTY,l[3],o,h,u)}}r.clipEndWithSlot(E)}r.clipEnd()}}d.QUAD_TRIANGLES=[0,1,2,2,3,0];var m=spine.TimeKeeper,c=spine.Skeleton,g=spine.AnimationState,y=spine.AnimationStateData;class _ extends t.Sprite{constructor(e=null){super(),this.currentPlayTime=0,this._pause=!0,this._currAniName=null,this._playbackRate=1,this._playAudio=!0,this._soundChannelArr=[],this.trackIndex=0,e&&this.init(e),this._ins=this}init(e){let s=this;this._templet=e,this._templet._addReference(1),this.skeleton=new c(this._templet.skeletonData),this.stateData=new y(this.skeleton.data),this.state=new g(this.stateData),this.skeletonRenderer=new d(!1),this.timeKeeper=new m,this.skeletonRenderer.premultipliedAlpha=this._templet.spinePremultipliedAlpha,this.state.addListener({start:function(e){},interrupt:function(e){},end:function(e){},dispose:function(e){},complete:function(e){e.loop?s.event(t.Event.COMPLETE):(s._currAniName=null,s.event(t.Event.STOPPED))},event:function(i,n){let a,r={audioValue:n.data.audioPath,audioPath:n.data.audioPath,floatValue:n.floatValue,intValue:n.intValue,name:n.data.name,stringValue:n.stringValue,time:1e3*n.time,balance:n.balance,volume:n.volume};s.event(t.Event.LABEL,r),s._playAudio&&r.audioValue&&(a=t.SoundManager.playSound(e._textureDic.root+r.audioValue,1,t.Handler.create(s,s._onAniSoundStoped),null,(1e3*s.currentPlayTime-r.time)/1e3),t.SoundManager.playbackRate=s._playbackRate,a&&s._soundChannelArr.push(a))}})}play(e,t,s=!0,i=0,n=0,a=!0,r=!0){this._playAudio=r,n/=1e3;let l=e;if((i/=1e3)<0||n<0)throw new Error("SpineSkeleton: start and end must large than zero.");if(0!==n&&i>n)throw new Error("SpineSkeleton: start must less than end.");if("number"==typeof l&&(l=this.getAniNameByIndex(e)),s||this._pause||this._currAniName!=l){this._currAniName=l,this.state.setAnimation(this.trackIndex,l,t);let e=this.state.getCurrent(this.trackIndex);e.animationStart=i,n&&n<e.animationEnd&&(e.animationEnd=n);let s=e.animation.duration;this._duration=s,this._playStart=i,this._playEnd=n<=s?n:s,this._pause&&(this._pause=!1,this.timer.frameLoop(1,this,this._update,null,!0)),this._update()}}_update(){this.timeKeeper.update();let e=this.timeKeeper.delta*this._playbackRate,t=this.state.getCurrent(this.trackIndex);this.state.update(e),this.state.apply(this.skeleton);let s=t.animationLast;this.currentPlayTime=Math.max(0,s),this.state&&this.skeleton&&(this.skeleton.updateWorldTransform(),this._ins.graphics.clear(),this.skeletonRenderer.draw(this.skeleton,-1,-1,this._ins,this._templet._textureDic))}getAnimNum(){return this._templet.skeletonData.animations.length}getAniNameByIndex(e){return this._templet.getAniNameByIndex(e)}getSlotByName(e){return this.skeleton.findSlot(e)}playbackRate(e){this._playbackRate=e}showSkinByName(e){this.showSkinByIndex(this._templet.getSkinIndexByName(e))}showSkinByIndex(e){let t=this.skeleton.data.skins[e];this.skeleton.setSkin(t),this.skeleton.setSlotsToSetupPose()}stop(){this._pause||(this._pause=!0,this._currAniName=null,this.timer.clear(this,this._update),this.state.update(-this.currentPlayTime),this.currentPlayTime=0,this.event(t.Event.STOPPED),this._soundChannelArr.length>0&&this._onAniSoundStoped(!0))}paused(){if(!this._pause&&(this._pause=!0,this.timer.clear(this,this._update),this.event(t.Event.PAUSED),this._soundChannelArr.length>0)){let e;for(let t=this._soundChannelArr.length,s=0;s<t;s++)e=this._soundChannelArr[s],e.isStopped||e.pause()}}resume(){if(this._pause&&(this._pause=!1,this.timer.frameLoop(1,this,this._update,null,!0),this._soundChannelArr.length>0)){let e;for(let t=this._soundChannelArr.length,s=0;s<t;s++)e=this._soundChannelArr[s],e.audioBuffer&&e.resume()}}_onAniSoundStoped(e){let t;for(let s=this._soundChannelArr.length,i=0;i<s;i++)t=this._soundChannelArr[i],(t.isStopped||e)&&(!t.isStopped&&t.stop(),this._soundChannelArr.splice(i,1),s--,i--)}destroy(e=!0){super.destroy(e),this._templet._removeReference(1),this._templet=null,this.timeKeeper=null,this.skeleton=null,this.state.clearListeners(),this.state=null,this.skeletonRenderer=null,this.timer.clear(this,this._update),this._soundChannelArr.length>0&&this._onAniSoundStoped(!0)}get templet(){return this._templet}addAnimation(e,t=!1,s=0){s/=1e3;let i=e;"number"==typeof i&&(i=this.getAniNameByIndex(i)),this._currAniName=i,this.state.addAnimation(this.trackIndex,i,t,s)}setMix(e,t,s){s/=1e3;let i=e;"number"==typeof i&&(i=this.getAniNameByIndex(i));let n=t;"number"==typeof n&&(n=this.getAniNameByIndex(n)),this.stateData.setMix(i,n,s)}getBoneByName(e){return this.skeleton.findBone(e)}getSkeleton(){return this.skeleton}setSlotAttachment(e,t){this.skeleton.setAttachment(e,t)}set currentTime(e){if(this._currAniName&&this._templet){if((e/=1e3)<this._playStart||this._playEnd&&e>this._playEnd||e>this._duration)throw new Error("AnimationPlayer: value must large than playStartTime,small than playEndTime.");this.state.update(e-this.currentPlayTime),this.currentPlayTime=e}}get playState(){return this._currAniName?this._pause?_.paused:_.playing:_.stopped}}_.stopped=0,_.paused=1,_.playing=2,t.ILaya.regClass(_),t.ClassUtils.regClass("laya.layaspine.SpineSkeleton",_),t.ClassUtils.regClass("Laya.SpineSkeleton",_);class S extends t.Resource{constructor(){super(),this._isDestroyed=!1,this._textureDic={},this._layaPremultipliedAlpha=!0,this._spinePremultipliedAlpha=!1}get templet(){return this._templet}set templet(e){this._templet=e}get isDestroyed(){return this._isDestroyed}set isDestroyed(e){this._isDestroyed=e}get spinePremultipliedAlpha(){return this._spinePremultipliedAlpha}set spinePremultipliedAlpha(e){this._spinePremultipliedAlpha=e}buildArmature(){return new _(this)}getAniNameByIndex(e){let t=this.skeletonData.animations[e];return t?t.name:null}getSkinIndexByName(e){let t,s=this.skeletonData.skins;for(let i=0,n=s.length;i<n;i++)if(t=s[i],t.name==e)return i;return-1}destroy(){let e;for(e in this.isDestroyed=!0,this._textureDic)"root"!=e&&e&&this._textureDic[e].destroy();super.destroy()}}var k=spine.AssetManager,A=spine.AtlasAttachmentLoader,x=spine.SkeletonJson,f=spine.SkeletonBinary;class v extends S{constructor(){super(),this._textureDic={}}loadAni(e){let s=e.lastIndexOf("/")+1,i=e.slice(0,s),n=(e=e.slice(s)).replace(".json",".atlas").replace(".skel",".atlas");this._textureDic.root=i,this.clientId=i,this.atlasUrl=n,this.jsonOrSkelUrl=e,this.assetManager=new k(this._textureLoader.bind(this),i),this.assetManager.loadTextureAtlas(n),e.endsWith(".skel")?this.assetManager.loadBinary(e):this.assetManager.loadText(e),t.Laya.timer.frameOnce(1,this,this.loop)}_textureLoader(e){let t=e.url.replace(this.clientId,"");return this._textureDic[t]=new s(e.bitmap)}loop(){this.assetManager.isLoadingComplete()?this.parseSpineAni():this.assetManager.hasErrors()?this.event(t.Event.ERROR,"load failed:"+this.assetManager.getErrors()):t.Laya.timer.frameOnce(1,this,this.loop)}parseSpineAni(){if(this.isDestroyed)return void this.destroy();let e=this.assetManager.get(this.atlasUrl),s=new A(e);this.jsonOrSkelUrl.endsWith(".skel")?(this.skeletonBinary=new f(s),this.skeletonData=this.skeletonBinary.readSkeletonData(this.assetManager.get(this.jsonOrSkelUrl))):(this.skeletonJson=new x(s),this.skeletonData=this.skeletonJson.readSkeletonData(this.assetManager.get(this.jsonOrSkelUrl))),this.event(t.Event.COMPLETE,this)}buildArmature(){return super.buildArmature()}getAniNameByIndex(e){return super.getAniNameByIndex(e)}getSkinIndexByName(e){return super.getSkinIndexByName(e)}destroy(){super.destroy()}}var w,E,b=spine.AtlasAttachmentLoader,D=spine.SkeletonJson,B=spine.SkeletonBinary;class M extends S{constructor(){super(),this._textureDic={}}loadAni(e){let s=e.lastIndexOf("/")+1,n=e.slice(0,s),a=(e=e.slice(s)).replace(".json",".atlas").replace(".skel",".atlas");this._textureDic.root=n,this.pathPrefix=n,this.atlasUrl=a,this.jsonOrSkelUrl=e,this.assetManager=new i(n,new spine.Downloader,this._textureDic),this.assetManager.loadTextureAtlas(a),e.endsWith(".skel")?this.assetManager.loadBinary(e):this.assetManager.loadJson(e),t.Laya.timer.frameOnce(1,this,this.loop)}loop(){this.assetManager.isLoadingComplete()?this.parseSpineAni():this.assetManager.hasErrors()?this.event(t.Event.ERROR,"load failed:"+this.assetManager.getErrors()):t.Laya.timer.frameOnce(1,this,this.loop)}parseSpineAni(){if(this.isDestroyed)return void this.destroy();let e=this.assetManager.get(this.atlasUrl),s=new b(e);this.jsonOrSkelUrl.endsWith(".skel")?(this.skeletonBinary=new B(s),this.skeletonData=this.skeletonBinary.readSkeletonData(this.assetManager.get(this.jsonOrSkelUrl))):(this.skeletonJson=new D(s),this.skeletonData=this.skeletonJson.readSkeletonData(this.assetManager.get(this.jsonOrSkelUrl))),this.event(t.Event.COMPLETE,this)}buildArmature(){return super.buildArmature()}getAniNameByIndex(e){return super.getAniNameByIndex(e)}getSkinIndexByName(e){return super.getSkinIndexByName(e)}destroy(){super.destroy()}}(w=e.SpineVersion||(e.SpineVersion={})).v3_7="v3_7",w.v3_8="v3_8",w.v4_0="v4_0",(E=e.SpineFormat||(e.SpineFormat={})).json="json",E.binary="binary",e.SpineAssetManager=i,e.SpineGLTexture=s,e.SpineSkeleton=_,e.SpineSkeletonRenderer=d,e.SpineTemplet=class extends S{constructor(t){let s;if(super(),t===e.SpineVersion.v3_7||t===e.SpineVersion.v3_8)s=new v;else{if(t!==e.SpineVersion.v4_0)throw new Error("传入参数错误，请与服务提供商联系");s=new M}return s}loadAni(e){}buildArmature(){return null}getAniNameByIndex(e){return null}getSkinIndexByName(e){return null}destroy(){}},e.SpineTempletBase=S,e.SpineTemplet_3_x=v,e.SpineTemplet_4_0=M}(window.Laya=window.Laya||{},Laya);