window.Physics3D=function(t,i){return new Promise(e=>{var s=new WXWebAssembly.Memory({initial:t});WXWebAssembly.instantiate("libs/min/laya.physics3D.wasm.wasm",{LayaAirInteractive:i,wasi_unstable:{fd_close:()=>{console.log("fd_close")},fd_seek:()=>{console.log("fd_seek")},fd_write:()=>{console.log("fd_write")}},env:{memory:s}}).then(t=>{window.Physics3D=t.instance.exports,e()})})},function(t,i){"use strict";class e{constructor(){this._scale=new i.Vector3(1,1,1),this._centerMatrix=new i.Matrix4x4,this._attatched=!1,this._indexInCompound=-1,this._compoundParent=null,this._attatchedCollisionObject=null,this._referenceCount=0,this._localOffset=new i.Vector3(0,0,0),this._localRotation=new i.Quaternion(0,0,0,1),this.needsCustomCollisionCallback=!1}static __init__(){var t=i.ILaya3D.Physics3D._bullet;e._btScale=t.btVector3_create(1,1,1),e._btVector30=t.btVector3_create(0,0,0),e._btQuaternion0=t.btQuaternion_create(0,0,0,1),e._btTransform0=t.btTransform_create()}static _createAffineTransformation(t,i,e){var s=i.x,o=i.y,r=i.z,a=i.w,n=s+s,l=o+o,_=r+r,h=s*n,c=s*l,b=s*_,d=o*l,u=o*_,C=r*_,y=a*n,m=a*l,p=a*_;e[0]=1-(d+C),e[1]=c+p,e[2]=b-m,e[3]=0,e[4]=c-p,e[5]=1-(h+C),e[6]=u+y,e[7]=0,e[8]=b+m,e[9]=u-y,e[10]=1-(h+d),e[11]=0,e[12]=t.x,e[13]=t.y,e[14]=t.z,e[15]=1}get type(){return this._type}get localOffset(){return this._localOffset}set localOffset(t){this._localOffset=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}get localRotation(){return this._localRotation}set localRotation(t){this._localRotation=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}_setScale(t){if(this._compoundParent)this.updateLocalTransformations();else{var s=i.ILaya3D.Physics3D._bullet;s.btVector3_setValue(e._btScale,t.x,t.y,t.z),s.btCollisionShape_setLocalScaling(this._btShape,e._btScale)}}_addReference(){this._referenceCount++}_removeReference(){this._referenceCount--}updateLocalTransformations(){if(this._compoundParent){var t=e._tempVector30;i.Vector3.multiply(this.localOffset,this._scale,t),e._createAffineTransformation(t,this.localRotation,this._centerMatrix.elements)}else e._createAffineTransformation(this.localOffset,this.localRotation,this._centerMatrix.elements)}cloneTo(t){var i=t;this._localOffset.cloneTo(i.localOffset),this._localRotation.cloneTo(i.localRotation),i.localOffset=i.localOffset,i.localRotation=i.localRotation}clone(){return null}destroy(){this._btShape&&(i.ILaya3D.Physics3D._bullet.btCollisionShape_destroy(this._btShape),this._btShape=null)}}e.SHAPEORIENTATION_UPX=0,e.SHAPEORIENTATION_UPY=1,e.SHAPEORIENTATION_UPZ=2,e.SHAPETYPES_BOX=0,e.SHAPETYPES_SPHERE=1,e.SHAPETYPES_CYLINDER=2,e.SHAPETYPES_CAPSULE=3,e.SHAPETYPES_CONVEXHULL=4,e.SHAPETYPES_COMPOUND=5,e.SHAPETYPES_STATICPLANE=6,e.SHAPETYPES_CONE=7,e._tempVector30=new i.Vector3;class s extends e{constructor(t=1,o=1,r=1){super(),this._sizeX=t,this._sizeY=o,this._sizeZ=r,this._type=e.SHAPETYPES_BOX;var a=i.ILaya3D.Physics3D._bullet;a.btVector3_setValue(s._btSize,t/2,o/2,r/2),this._btShape=a.btBoxShape_create(s._btSize)}static __init__(){s._btSize=i.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}get sizeX(){return this._sizeX}get sizeY(){return this._sizeY}get sizeZ(){return this._sizeZ}clone(){var t=new s(this._sizeX,this._sizeY,this._sizeZ);return this.cloneTo(t),t}}class o extends e{constructor(t=.5,s=1.25,o=e.SHAPEORIENTATION_UPY){super(),this._radius=t,this._length=s,this._orientation=o,this._type=e.SHAPETYPES_CAPSULE;var r=i.ILaya3D.Physics3D._bullet;switch(o){case e.SHAPEORIENTATION_UPX:this._btShape=r.btCapsuleShapeX_create(t,s-2*t);break;case e.SHAPEORIENTATION_UPY:this._btShape=r.btCapsuleShape_create(t,s-2*t);break;case e.SHAPEORIENTATION_UPZ:this._btShape=r.btCapsuleShapeZ_create(t,s-2*t);break;default:throw"CapsuleColliderShape:unknown orientation."}}get radius(){return this._radius}get length(){return this._length}get orientation(){return this._orientation}_setScale(t){var i=o._tempVector30;switch(this.orientation){case e.SHAPEORIENTATION_UPX:i.x=t.x,i.y=i.z=Math.max(t.y,t.z);break;case e.SHAPEORIENTATION_UPY:i.y=t.y,i.x=i.z=Math.max(t.x,t.z);break;case e.SHAPEORIENTATION_UPZ:i.z=t.z,i.x=i.y=Math.max(t.x,t.y);break;default:throw"CapsuleColliderShape:unknown orientation."}super._setScale(i)}clone(){var t=new o(this._radius,this._length,this._orientation);return this.cloneTo(t),t}}o._tempVector30=new i.Vector3;class r extends e{constructor(){super(),this._childColliderShapes=[],this._type=e.SHAPETYPES_COMPOUND,this._btShape=i.ILaya3D.Physics3D._bullet.btCompoundShape_create()}static __init__(){var t=i.ILaya3D.Physics3D._bullet;r._btVector3One=t.btVector3_create(1,1,1),r._btTransform=t.btTransform_create(),r._btOffset=t.btVector3_create(0,0,0),r._btRotation=t.btQuaternion_create(0,0,0,1)}_clearChildShape(t){t._attatched=!1,t._compoundParent=null,t._indexInCompound=-1}_addReference(){}_removeReference(){}_updateChildTransform(t){var s=i.ILaya3D.Physics3D._bullet,o=t.localOffset,r=t.localRotation,a=e._btVector30,n=e._btQuaternion0,l=e._btTransform0;s.btVector3_setValue(a,-o.x,o.y,o.z),s.btQuaternion_setValue(n,-r.x,r.y,r.z,-r.w),s.btTransform_setOrigin(l,a),s.btTransform_setRotation(l,n),s.btCompoundShape_updateChildTransform(this._btShape,t._indexInCompound,l,!0)}addChildShape(t){if(t._attatched)throw"CompoundColliderShape: this shape has attatched to other entity.";t._attatched=!0,t._compoundParent=this,t._indexInCompound=this._childColliderShapes.length,this._childColliderShapes.push(t);var e=t.localOffset,s=t.localRotation,o=i.ILaya3D.Physics3D._bullet;o.btVector3_setValue(r._btOffset,-e.x,e.y,e.z),o.btQuaternion_setValue(r._btRotation,-s.x,s.y,s.z,-s.w),o.btTransform_setOrigin(r._btTransform,r._btOffset),o.btTransform_setRotation(r._btTransform,r._btRotation);var a=o.btCollisionShape_getLocalScaling(this._btShape);o.btCollisionShape_setLocalScaling(this._btShape,r._btVector3One),o.btCompoundShape_addChildShape(this._btShape,r._btTransform,t._btShape),o.btCollisionShape_setLocalScaling(this._btShape,a),this._attatchedCollisionObject&&(this._attatchedCollisionObject.colliderShape=this)}removeChildShape(t){if(t._compoundParent===this){var e=t._indexInCompound;this._clearChildShape(t);var s=this._childColliderShapes[this._childColliderShapes.length-1];s._indexInCompound=e,this._childColliderShapes[e]=s,this._childColliderShapes.pop(),i.ILaya3D.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,e)}}clearChildShape(){for(var t=0,e=this._childColliderShapes.length;t<e;t++)this._clearChildShape(this._childColliderShapes[t]),i.ILaya3D.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,0);this._childColliderShapes.length=0}getChildShapeCount(){return this._childColliderShapes.length}cloneTo(t){var i=t;i.clearChildShape();for(var e=0,s=this._childColliderShapes.length;e<s;e++)i.addChildShape(this._childColliderShapes[e].clone())}clone(){var t=new r;return this.cloneTo(t),t}destroy(){super.destroy();for(var t=0,i=this._childColliderShapes.length;t<i;t++){var e=this._childColliderShapes[t];0===e._referenceCount&&e.destroy()}}}class a extends e{constructor(t=.5,s=1,o=e.SHAPEORIENTATION_UPY){super(),this._radius=1,this._height=.5,this._radius=t,this._height=s,this._orientation=o,this._type=e.SHAPETYPES_CYLINDER;var r=i.ILaya3D.Physics3D._bullet;switch(o){case e.SHAPEORIENTATION_UPX:this._btShape=r.btConeShapeX_create(t,s);break;case e.SHAPEORIENTATION_UPY:this._btShape=r.btConeShape_create(t,s);break;case e.SHAPEORIENTATION_UPZ:this._btShape=r.btConeShapeZ_create(t,s);break;default:throw"ConeColliderShape:unknown orientation."}}get radius(){return this._radius}get height(){return this._height}get orientation(){return this._orientation}clone(){var t=new a(this._radius,this._height,this._orientation);return this.cloneTo(t),t}}class n extends e{constructor(t=.5,s=1,o=e.SHAPEORIENTATION_UPY){super(),this._radius=1,this._height=.5,this._radius=t,this._height=s,this._orientation=o,this._type=e.SHAPETYPES_CYLINDER;var r=i.ILaya3D.Physics3D._bullet;switch(o){case e.SHAPEORIENTATION_UPX:r.btVector3_setValue(n._btSize,s/2,t,t),this._btShape=r.btCylinderShapeX_create(n._btSize);break;case e.SHAPEORIENTATION_UPY:r.btVector3_setValue(n._btSize,t,s/2,t),this._btShape=r.btCylinderShape_create(n._btSize);break;case e.SHAPEORIENTATION_UPZ:r.btVector3_setValue(n._btSize,t,t,s/2),this._btShape=r.btCylinderShapeZ_create(n._btSize);break;default:throw"CapsuleColliderShape:unknown orientation."}}static __init__(){n._btSize=i.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}get radius(){return this._radius}get height(){return this._height}get orientation(){return this._orientation}clone(){var t=new n(this._radius,this._height,this._orientation);return this.cloneTo(t),t}}class l extends e{constructor(){super(),this._mesh=null,this._convex=!1}get mesh(){return this._mesh}set mesh(t){if(t&&this._mesh!==t){var e=i.ILaya3D.Physics3D._bullet;this._physicMesh=t._getPhysicMesh(),this._mesh&&e.btCollisionShape_destroy(this._btShape),this._setPhysicsMesh(),this._mesh=t}}get convex(){return this._convex}set convex(t){this._convex=t}_setPhysicsMesh(){this._attatchedCollisionObject&&this._createBvhTriangleCollider()}_createDynamicMeshCollider(){var t=i.ILaya3D.Physics3D._bullet;this._physicMesh&&(this._btShape=t.btGImpactMeshShape_create(this._physicMesh),t.btGImpactShapeInterface_updateBound(this._btShape))}_createBvhTriangleCollider(){var t=i.ILaya3D.Physics3D._bullet;this._physicMesh&&(this._btShape=t.btBvhTriangleMeshShape_create(this._physicMesh))}_setScale(t){if(this._compoundParent)this.updateLocalTransformations();else{var s=i.ILaya3D.Physics3D._bullet;s.btVector3_setValue(e._btScale,t.x,t.y,t.z),s.btCollisionShape_setLocalScaling(this._btShape,e._btScale),this._attatchedCollisionObject&&this._attatchedCollisionObject._enableProcessCollisions&&s.btGImpactShapeInterface_updateBound(this._btShape)}}cloneTo(t){var i=t;i.convex=this._convex,i.mesh=this._mesh,super.cloneTo(t)}clone(){var t=new l;return this.cloneTo(t),t}destroy(){this._btShape&&(i.ILaya3D.Physics3D._bullet.btCollisionShape_destroy(this._btShape),this._btShape=null)}}class _ extends e{constructor(t=.5){super(),this._radius=t,this._type=e.SHAPETYPES_SPHERE,this._btShape=i.ILaya3D.Physics3D._bullet.btSphereShape_create(t)}get radius(){return this._radius}clone(){var t=new _(this._radius);return this.cloneTo(t),t}}class h extends i.Component{constructor(t,e){super(),this._restitution=0,this._friction=.5,this._rollingFriction=0,this._ccdMotionThreshold=0,this._ccdSweptSphereRadius=0,this._collisionGroup=i.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,this._canCollideWith=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,this._colliderShape=null,this._transformFlag=2147483647,this._controlBySimulation=!1,this._enableProcessCollisions=!0,this._inPhysicUpdateListIndex=-1,this.canScaleShape=!0,this._collisionGroup=t,this._canCollideWith=e,h._physicObjectsMap[this.id]=this}static __init__(){var t=i.ILaya3D.Physics3D._bullet;h._btVector30=t.btVector3_create(0,0,0),h._btQuaternion0=t.btQuaternion_create(0,0,0,1)}static _createAffineTransformationArray(t,i,e,s,o,r,a,n,l){var _=s+s,h=o+o,c=r+r,b=s*_,d=s*h,u=s*c,C=o*h,y=o*c,m=r*c,p=a*_,g=a*h,T=a*c,S=n[0],I=n[1],O=n[2];l[0]=(1-(C+m))*S,l[1]=(d+T)*S,l[2]=(u-g)*S,l[3]=0,l[4]=(d-T)*I,l[5]=(1-(b+m))*I,l[6]=(y+p)*I,l[7]=0,l[8]=(u+g)*O,l[9]=(y-p)*O,l[10]=(1-(b+C))*O,l[11]=0,l[12]=t,l[13]=i,l[14]=e,l[15]=1}static _creatShape(t){var e;switch(t.type){case"BoxColliderShape":var r=t.size;e=r?new s(r[0],r[1],r[2]):new s;break;case"SphereColliderShape":e=new _(t.radius);break;case"CapsuleColliderShape":e=new o(t.radius,t.height,t.orientation);break;case"MeshColliderShape":var h=new l;t.mesh&&(h.mesh=i.Loader.getRes(t.mesh)),e=h;break;case"ConeColliderShape":e=new a(t.radius,t.height,t.orientation);break;case"CylinderColliderShape":e=new n(t.radius,t.height,t.orientation);break;default:throw"unknown shape type."}if(t.center){var c=e.localOffset;c.fromArray(t.center),e.localOffset=c}return e}static physicVector3TransformQuat(t,i,e,s,o,r){var a=t.x,n=t.y,l=t.z,_=o*a+e*l-s*n,h=o*n+s*a-i*l,c=o*l+i*n-e*a,b=-i*a-e*n-s*l;r.x=_*o+b*-i+h*-s-c*-e,r.y=h*o+b*-e+c*-i-_*-s,r.z=c*o+b*-s+_*-e-h*-i}static physicQuaternionMultiply(t,i,e,s,o,r){var a=o.x,n=o.y,l=o.z,_=o.w,h=i*l-e*n,c=e*a-t*l,b=t*n-i*a,d=t*a+i*n+e*l;r.x=t*_+a*s+h,r.y=i*_+n*s+c,r.z=e*_+l*s+b,r.w=s*_-d}get restitution(){return this._restitution}set restitution(t){this._restitution=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_setRestitution(this._btColliderObject,t)}get friction(){return this._friction}set friction(t){this._friction=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_setFriction(this._btColliderObject,t)}get rollingFriction(){return this._rollingFriction}set rollingFriction(t){this._rollingFriction=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_setRollingFriction(this._btColliderObject,t)}get ccdMotionThreshold(){return this._ccdMotionThreshold}set ccdMotionThreshold(t){this._ccdMotionThreshold=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_setCcdMotionThreshold(this._btColliderObject,t)}get ccdSweptSphereRadius(){return this._ccdSweptSphereRadius}set ccdSweptSphereRadius(t){this._ccdSweptSphereRadius=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_setCcdSweptSphereRadius(this._btColliderObject,t)}get isActive(){return!!this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_isActive(this._btColliderObject)}get colliderShape(){return this._colliderShape}set colliderShape(t){var e=this._colliderShape;if(e&&(e._attatched=!1,e._attatchedCollisionObject=null),this._colliderShape=t,t){if(t._attatched)throw"PhysicsComponent: this shape has attatched to other entity.";if(t._attatched=!0,t._attatchedCollisionObject=this,t._physicMesh&&t._setPhysicsMesh(),this._btColliderObject){i.ILaya3D.Physics3D._bullet.btCollisionObject_setCollisionShape(this._btColliderObject,t._btShape);var s=this._simulation&&this._enabled;s&&e&&this._removeFromSimulation(),this._onShapeChange(t),s&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}}else this._simulation&&this._enabled&&e&&this._removeFromSimulation()}get simulation(){return this._simulation}get collisionGroup(){return this._collisionGroup}set collisionGroup(t){this._collisionGroup!==t&&(this._collisionGroup=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}get canCollideWith(){return this._canCollideWith}set canCollideWith(t){this._canCollideWith!==t&&(this._canCollideWith=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}_parseShape(t){var i=t.length;if(1===i){var e=h._creatShape(t[0]);this.colliderShape=e}else{for(var s=new r,o=0;o<i;o++)e=h._creatShape(t[o]),s.addChildShape(e);this.colliderShape=s}}_onScaleChange(t){this._colliderShape._setScale(t)}_onEnable(){this._simulation=this.owner._scene.physicsSimulation,i.ILaya3D.Physics3D._bullet.btCollisionObject_setContactProcessingThreshold(this._btColliderObject,0),this._colliderShape&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}_onDisable(){this._colliderShape&&(this._removeFromSimulation(),-1!==this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.remove(this)),this._simulation=null}_onDestroy(){delete h._physicObjectsMap[this.id],i.ILaya3D.Physics3D._bullet.btCollisionObject_destroy(this._btColliderObject),this._colliderShape&&this._colliderShape.destroy(),super._onDestroy(),this._btColliderObject=null,this._colliderShape=null,this._simulation=null,this.owner.transform.off(i.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}_isValid(){return this._simulation&&this._colliderShape&&this._enabled}_parse(t){null!=t.collisionGroup&&(this.collisionGroup=t.collisionGroup),null!=t.canCollideWith&&(this.canCollideWith=t.canCollideWith),null!=t.ccdMotionThreshold&&(this.ccdMotionThreshold=t.ccdMotionThreshold),null!=t.ccdSweptSphereRadius&&(this.ccdSweptSphereRadius=t.ccdSweptSphereRadius)}_setTransformFlag(t,i){i?this._transformFlag|=t:this._transformFlag&=~t}_getTransformFlag(t){return 0!=(this._transformFlag&t)}_addToSimulation(){}_removeFromSimulation(){}_derivePhysicsTransformation(t){var e=i.ILaya3D.Physics3D._bullet,s=this._btColliderObject,o=e.btCollisionObject_getWorldTransform(s);this._innerDerivePhysicsTransformation(o,t),e.btCollisionObject_setWorldTransform(s,o)}_innerDerivePhysicsTransformation(t,e){var s=i.ILaya3D.Physics3D._bullet,o=this.owner._transform;if(e||this._getTransformFlag(i.Transform3D.TRANSFORM_WORLDPOSITION)){var r=this._colliderShape.localOffset,a=o.position,n=h._btVector30;if(0!==r.x||0!==r.y||0!==r.z){var l=h._tempVector30,_=o.worldMatrix;i.Vector3.transformCoordinate(r,_,l),s.btVector3_setValue(n,-l.x,l.y,l.z)}else s.btVector3_setValue(n,-a.x,a.y,a.z);s.btTransform_setOrigin(t,n),this._setTransformFlag(i.Transform3D.TRANSFORM_WORLDPOSITION,!1)}if(e||this._getTransformFlag(i.Transform3D.TRANSFORM_WORLDQUATERNION)){var c=this._colliderShape.localRotation,b=h._btQuaternion0,d=o.rotation;if(0!==c.x||0!==c.y||0!==c.z||1!==c.w){var u=h._tempQuaternion0;h.physicQuaternionMultiply(d.x,d.y,d.z,d.w,c,u),s.btQuaternion_setValue(b,-u.x,u.y,u.z,-u.w)}else s.btQuaternion_setValue(b,-d.x,d.y,d.z,-d.w);s.btTransform_setRotation(t,b),this._setTransformFlag(i.Transform3D.TRANSFORM_WORLDQUATERNION,!1)}(e||this._getTransformFlag(i.Transform3D.TRANSFORM_WORLDSCALE))&&(this._onScaleChange(o.getWorldLossyScale()),this._setTransformFlag(i.Transform3D.TRANSFORM_WORLDSCALE,!1))}_updateTransformComponent(t){var e=i.ILaya3D.Physics3D._bullet,s=this._colliderShape,o=s.localOffset,r=s.localRotation,a=this.owner._transform,n=a.position,l=a.rotation,_=e.btTransform_getOrigin(t),c=e.btTransform_getRotation(t),b=-e.btQuaternion_x(c),d=e.btQuaternion_y(c),u=e.btQuaternion_z(c),C=-e.btQuaternion_w(c);if(0!==r.x||0!==r.y||0!==r.z||1!==r.w){var y=h._tempQuaternion0;r.invert(y),h.physicQuaternionMultiply(b,d,u,C,y,l)}else l.x=b,l.y=d,l.z=u,l.w=C;if(a.rotation=l,0!==o.x||0!==o.y||0!==o.z){var m=e.btCollisionShape_getLocalScaling(s._btShape),p=h._tempVector30;p.x=o.x*e.btVector3_x(m),p.y=o.y*e.btVector3_y(m),p.z=o.z*e.btVector3_z(m),i.Vector3.transformQuat(p,l,p),n.x=-e.btVector3_x(_)-p.x,n.y=e.btVector3_y(_)-p.y,n.z=e.btVector3_z(_)-p.z}else n.x=-e.btVector3_x(_),n.y=e.btVector3_y(_),n.z=e.btVector3_z(_);a.position=n}_onShapeChange(t){var e=this._btColliderObject,s=i.ILaya3D.Physics3D._bullet,o=s.btCollisionObject_getCollisionFlags(e);t.needsCustomCollisionCallback?0==(o&h.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)&&s.btCollisionObject_setCollisionFlags(e,o|h.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK):(o&h.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)>0&&s.btCollisionObject_setCollisionFlags(e,o^h.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)}_onAdded(){this.enabled=this._enabled,this.restitution=this._restitution,this.friction=this._friction,this.rollingFriction=this._rollingFriction,this.ccdMotionThreshold=this._ccdMotionThreshold,this.ccdSweptSphereRadius=this._ccdSweptSphereRadius,this.owner.transform.on(i.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}_onTransformChanged(t){!h._addUpdateList&&this._controlBySimulation||(t&=i.Transform3D.TRANSFORM_WORLDPOSITION|i.Transform3D.TRANSFORM_WORLDQUATERNION|i.Transform3D.TRANSFORM_WORLDSCALE)&&(this._transformFlag|=t,this._isValid()&&-1===this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.add(this))}_cloneTo(t){var i=t;i.restitution=this._restitution,i.friction=this._friction,i.rollingFriction=this._rollingFriction,i.ccdMotionThreshold=this._ccdMotionThreshold,i.ccdSweptSphereRadius=this._ccdSweptSphereRadius,i.collisionGroup=this._collisionGroup,i.canCollideWith=this._canCollideWith,i.canScaleShape=this.canScaleShape,this._colliderShape&&(i.colliderShape=this._colliderShape.clone())}}h.ACTIVATIONSTATE_ACTIVE_TAG=1,h.ACTIVATIONSTATE_ISLAND_SLEEPING=2,h.ACTIVATIONSTATE_WANTS_DEACTIVATION=3,h.ACTIVATIONSTATE_DISABLE_DEACTIVATION=4,h.ACTIVATIONSTATE_DISABLE_SIMULATION=5,h.COLLISIONFLAGS_STATIC_OBJECT=1,h.COLLISIONFLAGS_KINEMATIC_OBJECT=2,h.COLLISIONFLAGS_NO_CONTACT_RESPONSE=4,h.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK=8,h.COLLISIONFLAGS_CHARACTER_OBJECT=16,h.COLLISIONFLAGS_DISABLE_VISUALIZE_OBJECT=32,h.COLLISIONFLAGS_DISABLE_SPU_COLLISION_PROCESSING=64,h._tempVector30=new i.Vector3,h._tempQuaternion0=new i.Quaternion,h._tempQuaternion1=new i.Quaternion,h._tempMatrix4x40=new i.Matrix4x4,h._physicObjectsMap={},h._addUpdateList=!0;class c{}c._interactive={getWorldTransform:(t,i)=>{},setWorldTransform:(t,i)=>{var e=h._physicObjectsMap[t];e._simulation._updatedRigidbodies++,e._updateTransformComponent(i)}};class b extends h{constructor(t=.1,e=null,s=i.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,o=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER){super(s,o),this._upAxis=new i.Vector3(0,1,0),this._maxSlope=45,this._jumpSpeed=10,this._fallSpeed=55,this._gravity=new i.Vector3(0,3*-9.8,0),this._btKinematicCharacter=null,this._stepHeight=t,e&&(this._upAxis=e),this._controlBySimulation=!0}static __init__(){b._btTempVector30=i.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}get fallSpeed(){return this._fallSpeed}set fallSpeed(t){this._fallSpeed=t,i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setFallSpeed(this._btKinematicCharacter,t)}get jumpSpeed(){return this._jumpSpeed}set jumpSpeed(t){this._jumpSpeed=t,i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setJumpSpeed(this._btKinematicCharacter,t)}get gravity(){return this._gravity}set gravity(t){this._gravity=t;var e=i.ILaya3D.Physics3D._bullet,s=b._btTempVector30;e.btVector3_setValue(s,-t.x,t.y,t.z),e.btKinematicCharacterController_setGravity(this._btKinematicCharacter,s)}get maxSlope(){return this._maxSlope}set maxSlope(t){this._maxSlope=t,i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setMaxSlope(this._btKinematicCharacter,t/180*Math.PI)}get isGrounded(){return i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_onGround(this._btKinematicCharacter)}get stepHeight(){return this._stepHeight}set stepHeight(t){this._stepHeight=t,i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setStepHeight(this._btKinematicCharacter,t)}get upAxis(){return this._upAxis}set upAxis(t){this._upAxis=t;var e=b._btTempVector30;i.Utils3D._convertToBulletVec3(t,e,!1),i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setUp(this._btKinematicCharacter,e)}_constructCharacter(){var t=i.ILaya3D.Physics3D._bullet;this._btKinematicCharacter&&t.btKinematicCharacterController_destroy(this._btKinematicCharacter);var e=b._btTempVector30;t.btVector3_setValue(e,this._upAxis.x,this._upAxis.y,this._upAxis.z),this._btKinematicCharacter=t.btKinematicCharacterController_create(this._btColliderObject,this._colliderShape._btShape,this._stepHeight,e),this.fallSpeed=this._fallSpeed,this.maxSlope=this._maxSlope,this.jumpSpeed=this._jumpSpeed,this.gravity=this._gravity}_onShapeChange(t){super._onShapeChange(t),this._constructCharacter()}_onAdded(){var t=i.ILaya3D.Physics3D._bullet,e=t.btPairCachingGhostObject_create();t.btCollisionObject_setUserIndex(e,this.id),t.btCollisionObject_setCollisionFlags(e,h.COLLISIONFLAGS_CHARACTER_OBJECT),this._btColliderObject=e,this._colliderShape&&this._constructCharacter(),super._onAdded()}_addToSimulation(){this._simulation._characters.push(this),this._simulation._addCharacter(this,this._collisionGroup,this._canCollideWith)}_removeFromSimulation(){this._simulation._removeCharacter(this);var t=this._simulation._characters;t.splice(t.indexOf(this),1)}_cloneTo(t){super._cloneTo(t);var i=t;i.stepHeight=this._stepHeight,i.upAxis=this._upAxis,i.maxSlope=this._maxSlope,i.jumpSpeed=this._jumpSpeed,i.fallSpeed=this._fallSpeed,i.gravity=this._gravity}_onDestroy(){i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_destroy(this._btKinematicCharacter),super._onDestroy(),this._btKinematicCharacter=null}move(t){var e=b._btVector30,s=i.ILaya3D.Physics3D._bullet;s.btVector3_setValue(e,-t.x,t.y,t.z),s.btKinematicCharacterController_setWalkDirection(this._btKinematicCharacter,e)}jump(t=null){var e=i.ILaya3D.Physics3D._bullet,s=b._btVector30;t?(i.Utils3D._convertToBulletVec3(t,s,!0),e.btKinematicCharacterController_jump(this._btKinematicCharacter,s)):(e.btVector3_setValue(s,0,0,0),e.btKinematicCharacterController_jump(this._btKinematicCharacter,s))}}b.UPAXIS_X=0,b.UPAXIS_Y=1,b.UPAXIS_Z=2;class d{constructor(){this._lastUpdateFrame=-2147483648,this._updateFrame=-2147483648,this._isTrigger=!1,this.contacts=[]}_setUpdateFrame(t){this._lastUpdateFrame=this._updateFrame,this._updateFrame=t}}class u{constructor(){this._idCounter=0,this.colliderA=null,this.colliderB=null,this.distance=0,this.normal=new i.Vector3,this.positionOnA=new i.Vector3,this.positionOnB=new i.Vector3,this._id=++this._idCounter}}class C{constructor(){this.succeeded=!1,this.collider=null,this.point=new i.Vector3,this.normal=new i.Vector3,this.hitFraction=0}}class y{constructor(){this._hitResultsPoolIndex=0,this._hitResultsPool=[],this._contactPonintsPoolIndex=0,this._contactPointsPool=[],this._collisionsPool=[],this._collisions={}}getHitResult(){var t=this._hitResultsPool[this._hitResultsPoolIndex++];return t||(t=new C,this._hitResultsPool.push(t)),t}recoverAllHitResultsPool(){this._hitResultsPoolIndex=0}getContactPoints(){var t=this._contactPointsPool[this._contactPonintsPoolIndex++];return t||(t=new u,this._contactPointsPool.push(t)),t}recoverAllContactPointsPool(){this._contactPonintsPoolIndex=0}getCollision(t,i){var e,s=t.id,o=i.id,r=this._collisions[s];return r&&(e=r[o]),e||(r||(r={},this._collisions[s]=r),(e=0===this._collisionsPool.length?new d:this._collisionsPool.pop())._colliderA=t,e._colliderB=i,r[o]=e),e}recoverCollision(t){var i=t._colliderA.id,e=t._colliderB.id;this._collisions[i][e]=null,this._collisionsPool.push(t)}garbageCollection(){for(var t in this._hitResultsPoolIndex=0,this._hitResultsPool.length=0,this._contactPonintsPoolIndex=0,this._contactPointsPool.length=0,this._collisionsPool.length=0,this._collisionsPool){var i=this._collisionsPool[t],e=!0;for(var s in i)i[s]?e=!1:delete i[s];e&&delete this._collisionsPool[t]}}}class m extends h{constructor(t,i){super(t,i),this._isTrigger=!1}get isTrigger(){return this._isTrigger}set isTrigger(t){this._isTrigger=t;var e=i.ILaya3D.Physics3D._bullet;if(this._btColliderObject){var s=e.btCollisionObject_getCollisionFlags(this._btColliderObject);t?0==(s&h.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&e.btCollisionObject_setCollisionFlags(this._btColliderObject,s|h.COLLISIONFLAGS_NO_CONTACT_RESPONSE):0!=(s&h.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&e.btCollisionObject_setCollisionFlags(this._btColliderObject,s^h.COLLISIONFLAGS_NO_CONTACT_RESPONSE)}}_onAdded(){super._onAdded(),this.isTrigger=this._isTrigger}_cloneTo(t){super._cloneTo(t),t.isTrigger=this._isTrigger}}class p extends i.SingletonList{constructor(){super()}add(t){if(-1!==t._inPhysicUpdateListIndex)throw"PhysicsUpdateList:element has  in  PhysicsUpdateList.";this._add(t),t._inPhysicUpdateListIndex=this.length++}remove(t){var i=t._inPhysicUpdateListIndex;if(this.length--,i!==this.length){var e=this.elements[this.length];this.elements[i]=e,e._inPhysicUpdateListIndex=i}t._inPhysicUpdateListIndex=-1}}class g{constructor(t){this._gravity=new i.Vector3(0,-10,0),this._btVector3Zero=i.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0),this._btDefaultQuaternion=i.ILaya3D.Physics3D._bullet.btQuaternion_create(0,0,0,-1),this._collisionsUtils=new y,this._previousFrameCollisions=[],this._currentFrameCollisions=[],this._currentConstraint={},this._physicsUpdateList=new p,this._characters=[],this._updatedRigidbodies=0,this.maxSubSteps=1,this.fixedTimeStep=1/60,this.maxSubSteps=t.maxSubSteps,this.fixedTimeStep=t.fixedTimeStep;var e=i.ILaya3D.Physics3D._bullet;this._btCollisionConfiguration=e.btDefaultCollisionConfiguration_create(),this._btDispatcher=e.btCollisionDispatcher_create(this._btCollisionConfiguration),this._btBroadphase=e.btDbvtBroadphase_create(),e.btOverlappingPairCache_setInternalGhostPairCallback(e.btDbvtBroadphase_getOverlappingPairCache(this._btBroadphase),e.btGhostPairCallback_create());var s=t.flags;if(s&g.PHYSICSENGINEFLAGS_COLLISIONSONLY)this._btCollisionWorld=new e.btCollisionWorld(this._btDispatcher,this._btBroadphase,this._btCollisionConfiguration);else{if(s&g.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT)throw"PhysicsSimulation:SoftBody processing is not yet available";var o=e.btSequentialImpulseConstraintSolver_create();this._btDiscreteDynamicsWorld=e.btDiscreteDynamicsWorld_create(this._btDispatcher,this._btBroadphase,o,this._btCollisionConfiguration),this._btCollisionWorld=this._btDiscreteDynamicsWorld}this._btDiscreteDynamicsWorld&&(this._btSolverInfo=e.btDynamicsWorld_getSolverInfo(this._btDiscreteDynamicsWorld),this._btDispatchInfo=e.btCollisionWorld_getDispatchInfo(this._btDiscreteDynamicsWorld)),this._btClosestRayResultCallback=e.ClosestRayResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btAllHitsRayResultCallback=e.AllHitsRayResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btClosestConvexResultCallback=e.ClosestConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btAllConvexResultCallback=e.AllConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero),e.btGImpactCollisionAlgorithm_RegisterAlgorithm(this._btDispatcher)}static __init__(){var t=i.ILaya3D.Physics3D._bullet;g._btTempVector30=t.btVector3_create(0,0,0),g._btTempVector31=t.btVector3_create(0,0,0),g._btTempQuaternion0=t.btQuaternion_create(0,0,0,1),g._btTempQuaternion1=t.btQuaternion_create(0,0,0,1),g._btTempTransform0=t.btTransform_create(),g._btTempTransform1=t.btTransform_create()}static createConstraint(){}get continuousCollisionDetection(){return i.ILaya3D.Physics3D._bullet.btCollisionWorld_get_m_useContinuous(this._btDispatchInfo)}set continuousCollisionDetection(t){i.ILaya3D.Physics3D._bullet.btCollisionWorld_set_m_useContinuous(this._btDispatchInfo,t)}get gravity(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";return this._gravity}set gravity(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._gravity=t;var e=i.ILaya3D.Physics3D._bullet,s=g._btTempVector30;e.btVector3_setValue(s,-t.x,t.y,t.z),e.btDiscreteDynamicsWorld_setGravity(this._btDiscreteDynamicsWorld,s)}get speculativeContactRestitution(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";return i.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_getApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld)}set speculativeContactRestitution(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_setApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld,t)}_simulate(t){this._updatedRigidbodies=0;var e=i.ILaya3D.Physics3D._bullet;this._btDiscreteDynamicsWorld?e.btDiscreteDynamicsWorld_stepSimulation(this._btDiscreteDynamicsWorld,t,this.maxSubSteps,this.fixedTimeStep):e.PerformDiscreteCollisionDetection(this._btCollisionWorld)}_destroy(){var t=i.ILaya3D.Physics3D._bullet;this._btDiscreteDynamicsWorld?(t.btCollisionWorld_destroy(this._btDiscreteDynamicsWorld),this._btDiscreteDynamicsWorld=null):(t.btCollisionWorld_destroy(this._btCollisionWorld),this._btCollisionWorld=null),t.btDbvtBroadphase_destroy(this._btBroadphase),this._btBroadphase=null,t.btCollisionDispatcher_destroy(this._btDispatcher),this._btDispatcher=null,t.btDefaultCollisionConfiguration_destroy(this._btCollisionConfiguration),this._btCollisionConfiguration=null}_addPhysicsCollider(t,e,s){i.ILaya3D.Physics3D._bullet.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,e,s)}_removePhysicsCollider(t){i.ILaya3D.Physics3D._bullet.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject)}_addRigidBody(t,e,s){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_addRigidBody(this._btCollisionWorld,t._btColliderObject,e,s)}_removeRigidBody(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_removeRigidBody(this._btCollisionWorld,t._btColliderObject)}_addCharacter(t,e,s){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var o=i.ILaya3D.Physics3D._bullet;o.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,e,s),o.btDynamicsWorld_addAction(this._btCollisionWorld,t._btKinematicCharacter)}_removeCharacter(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var e=i.ILaya3D.Physics3D._bullet;e.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject),e.btDynamicsWorld_removeAction(this._btCollisionWorld,t._btKinematicCharacter)}raycastFromTo(t,e,s=null,o=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER){var a=i.ILaya3D.Physics3D._bullet,n=this._btClosestRayResultCallback,l=g._btTempVector30,_=g._btTempVector31;if(a.btVector3_setValue(l,-t.x,t.y,t.z),a.btVector3_setValue(_,-e.x,e.y,e.z),a.ClosestRayResultCallback_set_m_rayFromWorld(n,l),a.ClosestRayResultCallback_set_m_rayToWorld(n,_),a.RayResultCallback_set_m_collisionFilterGroup(n,o),a.RayResultCallback_set_m_collisionFilterMask(n,r),a.RayResultCallback_set_m_collisionObject(n,null),a.RayResultCallback_set_m_closestHitFraction(n,1),a.btCollisionWorld_rayTest(this._btCollisionWorld,l,_,n),a.RayResultCallback_hasHit(n)){if(s){s.succeeded=!0,s.collider=h._physicObjectsMap[a.btCollisionObject_getUserIndex(a.RayResultCallback_get_m_collisionObject(n))],s.hitFraction=a.RayResultCallback_get_m_closestHitFraction(n);var c=a.ClosestRayResultCallback_get_m_hitPointWorld(n),b=s.point;b.x=-a.btVector3_x(c),b.y=a.btVector3_y(c),b.z=a.btVector3_z(c);var d=a.ClosestRayResultCallback_get_m_hitNormalWorld(n),u=s.normal;u.x=-a.btVector3_x(d),u.y=a.btVector3_y(d),u.z=a.btVector3_z(d)}return!0}return s&&(s.succeeded=!1),!1}raycastAllFromTo(t,e,s,o=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER){var a=i.ILaya3D.Physics3D._bullet,n=this._btAllHitsRayResultCallback,l=g._btTempVector30,_=g._btTempVector31;s.length=0,a.btVector3_setValue(l,-t.x,t.y,t.z),a.btVector3_setValue(_,-e.x,e.y,e.z),a.AllHitsRayResultCallback_set_m_rayFromWorld(n,l),a.AllHitsRayResultCallback_set_m_rayToWorld(n,_),a.RayResultCallback_set_m_collisionFilterGroup(n,o),a.RayResultCallback_set_m_collisionFilterMask(n,r);var c=a.AllHitsRayResultCallback_get_m_collisionObjects(n),b=a.AllHitsRayResultCallback_get_m_hitPointWorld(n),d=a.AllHitsRayResultCallback_get_m_hitNormalWorld(n),u=a.AllHitsRayResultCallback_get_m_hitFractions(n);a.tBtCollisionObjectArray_clear(c),a.tVector3Array_clear(b),a.tVector3Array_clear(d),a.tScalarArray_clear(u),a.btCollisionWorld_rayTest(this._btCollisionWorld,l,_,n);var C=a.tBtCollisionObjectArray_size(c);if(C>0){this._collisionsUtils.recoverAllHitResultsPool();for(var y=0;y<C;y++){var m=this._collisionsUtils.getHitResult();s.push(m),m.succeeded=!0,m.collider=h._physicObjectsMap[a.btCollisionObject_getUserIndex(a.tBtCollisionObjectArray_at(c,y))],m.hitFraction=a.tScalarArray_at(u,y);var p=a.tVector3Array_at(b,y),T=m.point;T.x=-a.btVector3_x(p),T.y=a.btVector3_y(p),T.z=a.btVector3_z(p);var S=a.tVector3Array_at(d,y),I=m.normal;I.x=-a.btVector3_x(S),I.y=a.btVector3_y(S),I.z=a.btVector3_z(S)}return!0}return!1}rayCast(t,e=null,s=2147483647,o=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER){var a=t.origin,n=g._tempVector30;return i.Vector3.normalize(t.direction,n),i.Vector3.scale(n,s,n),i.Vector3.add(a,n,n),this.raycastFromTo(a,n,e,o,r)}rayCastAll(t,e,s=2147483647,o=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER){var a=t.origin,n=g._tempVector30;return i.Vector3.normalize(t.direction,n),i.Vector3.scale(n,s,n),i.Vector3.add(a,n,n),this.raycastAllFromTo(a,n,e,o,r)}shapeCast(t,e,s,o=null,r=null,a=null,n=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,l=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,_=0){var c=i.ILaya3D.Physics3D._bullet,b=this._btClosestConvexResultCallback,d=g._btTempVector30,u=g._btTempVector31,C=g._btTempQuaternion0,y=g._btTempQuaternion1,m=g._btTempTransform0,p=g._btTempTransform1,T=t._btShape;if(c.btVector3_setValue(d,-e.x,e.y,e.z),c.btVector3_setValue(u,-s.x,s.y,s.z),c.ConvexResultCallback_set_m_collisionFilterGroup(b,n),c.ConvexResultCallback_set_m_collisionFilterMask(b,l),c.btTransform_setOrigin(m,d),c.btTransform_setOrigin(p,u),r?(c.btQuaternion_setValue(C,-r.x,r.y,r.z,-r.w),c.btTransform_setRotation(m,C)):c.btTransform_setRotation(m,this._btDefaultQuaternion),a?(c.btQuaternion_setValue(y,-a.x,a.y,a.z,-a.w),c.btTransform_setRotation(p,y)):c.btTransform_setRotation(p,this._btDefaultQuaternion),c.ClosestConvexResultCallback_set_m_hitCollisionObject(b,null),c.ConvexResultCallback_set_m_closestHitFraction(b,1),c.btCollisionWorld_convexSweepTest(this._btCollisionWorld,T,m,p,b,_),c.ConvexResultCallback_hasHit(b)){if(o){o.succeeded=!0,o.collider=h._physicObjectsMap[c.btCollisionObject_getUserIndex(c.ClosestConvexResultCallback_get_m_hitCollisionObject(b))],o.hitFraction=c.ConvexResultCallback_get_m_closestHitFraction(b);var S=c.ClosestConvexResultCallback_get_m_hitPointWorld(b),I=c.ClosestConvexResultCallback_get_m_hitNormalWorld(b),O=o.point,L=o.normal;O.x=-c.btVector3_x(S),O.y=c.btVector3_y(S),O.z=c.btVector3_z(S),L.x=-c.btVector3_x(I),L.y=c.btVector3_y(I),L.z=c.btVector3_z(I)}return!0}return o&&(o.succeeded=!1),!1}shapeCastAll(t,e,s,o,r=null,a=null,n=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,l=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,_=0){var c=i.ILaya3D.Physics3D._bullet,b=this._btAllConvexResultCallback,d=g._btTempVector30,u=g._btTempVector31,C=g._btTempQuaternion0,y=g._btTempQuaternion1,m=g._btTempTransform0,p=g._btTempTransform1,T=t._btShape;o.length=0,c.btVector3_setValue(d,-e.x,e.y,e.z),c.btVector3_setValue(u,-s.x,s.y,s.z),c.ConvexResultCallback_set_m_collisionFilterGroup(b,n),c.ConvexResultCallback_set_m_collisionFilterMask(b,l),c.btTransform_setOrigin(m,d),c.btTransform_setOrigin(p,u),r?(c.btQuaternion_setValue(C,-r.x,r.y,r.z,-r.w),c.btTransform_setRotation(m,C)):c.btTransform_setRotation(m,this._btDefaultQuaternion),a?(c.btQuaternion_setValue(y,-a.x,a.y,a.z,-a.w),c.btTransform_setRotation(p,y)):c.btTransform_setRotation(p,this._btDefaultQuaternion);var S=c.AllConvexResultCallback_get_m_collisionObjects(b),I=c.AllConvexResultCallback_get_m_hitPointWorld(b),O=c.AllConvexResultCallback_get_m_hitNormalWorld(b),L=c.AllConvexResultCallback_get_m_hitFractions(b);c.tVector3Array_clear(I),c.tVector3Array_clear(O),c.tScalarArray_clear(L),c.tBtCollisionObjectArray_clear(S),c.btCollisionWorld_convexSweepTest(this._btCollisionWorld,T,m,p,b,_);var D=c.tBtCollisionObjectArray_size(S);if(D>0){this._collisionsUtils.recoverAllHitResultsPool();for(var A=0;A<D;A++){var R=this._collisionsUtils.getHitResult();o.push(R),R.succeeded=!0,R.collider=h._physicObjectsMap[c.btCollisionObject_getUserIndex(c.tBtCollisionObjectArray_at(S,A))],R.hitFraction=c.tScalarArray_at(L,A);var P=c.tVector3Array_at(I,A),f=R.point;f.x=-c.btVector3_x(P),f.y=c.btVector3_y(P),f.z=c.btVector3_z(P);var N=c.tVector3Array_at(O,A),E=R.normal;E.x=-c.btVector3_x(N),E.y=c.btVector3_y(N),E.z=c.btVector3_z(N)}return!0}return!1}addConstraint(t,e=!1){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btCollisionWorld_addConstraint(this._btDiscreteDynamicsWorld,t._btConstraint,e),this._currentConstraint[t.id]=t}removeConstraint(t){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btCollisionWorld_removeConstraint(this._btDiscreteDynamicsWorld,t._btConstraint),delete this._currentConstraint[t.id]}setHitsRayResultCallbackFlag(t=1){var e=i.ILaya3D.Physics3D._bullet;e.RayResultCallback_set_m_flags(this._btAllHitsRayResultCallback,t),e.RayResultCallback_set_m_flags(this._btClosestRayResultCallback,t)}_updatePhysicsTransformFromRender(){for(var t=this._physicsUpdateList.elements,i=0,e=this._physicsUpdateList.length;i<e;i++){var s=t[i];s._derivePhysicsTransformation(!1),s._inPhysicUpdateListIndex=-1}this._physicsUpdateList.length=0}_updateCharacters(){for(var t=0,e=this._characters.length;t<e;t++){var s=this._characters[t];s._updateTransformComponent(i.ILaya3D.Physics3D._bullet.btCollisionObject_getWorldTransform(s._btColliderObject))}}_updateCollisions(){this._collisionsUtils.recoverAllContactPointsPool();var t=this._currentFrameCollisions;this._currentFrameCollisions=this._previousFrameCollisions,this._currentFrameCollisions.length=0,this._previousFrameCollisions=t;for(var e=i.Stat.loopCount,s=i.ILaya3D.Physics3D._bullet,o=s.btDispatcher_getNumManifolds(this._btDispatcher),r=0;r<o;r++){var a,n=s.btDispatcher_getManifoldByIndexInternal(this._btDispatcher,r),l=h._physicObjectsMap[s.btCollisionObject_getUserIndex(s.btPersistentManifold_getBody0(n))],_=h._physicObjectsMap[s.btCollisionObject_getUserIndex(s.btPersistentManifold_getBody1(n))],c=null,b=null;if((l.isTrigger||_.isTrigger)&&(l.owner._needProcessTriggers||_.owner._needProcessTriggers))for(var d=s.btPersistentManifold_getNumContacts(n),u=0;u<d;u++){var C=s.btPersistentManifold_getContactPoint(n,u),y=s.btManifoldPoint_getDistance(C);if(y<=0){b=(c=this._collisionsUtils.getCollision(l,_)).contacts,(a=c._updateFrame!==e)&&(c._isTrigger=!0,b.length=0);break}}else if((l.owner._needProcessCollisions||_.owner._needProcessCollisions)&&(l._enableProcessCollisions||_._enableProcessCollisions))for(d=s.btPersistentManifold_getNumContacts(n),u=0;u<d;u++)if(C=s.btPersistentManifold_getContactPoint(n,u),(y=s.btManifoldPoint_getDistance(C))<=0){var m=this._collisionsUtils.getContactPoints();m.colliderA=l,m.colliderB=_,m.distance=y;var p=s.btManifoldPoint_get_m_normalWorldOnB(C),g=m.normal;g.x=-s.btVector3_x(p),g.y=s.btVector3_y(p),g.z=s.btVector3_z(p);var T=s.btManifoldPoint_get_m_positionWorldOnA(C),S=m.positionOnA;S.x=-s.btVector3_x(T),S.y=s.btVector3_y(T),S.z=s.btVector3_z(T);var I=s.btManifoldPoint_get_m_positionWorldOnB(C),O=m.positionOnB;O.x=-s.btVector3_x(I),O.y=s.btVector3_y(I),O.z=s.btVector3_z(I),c||(b=(c=this._collisionsUtils.getCollision(l,_)).contacts,(a=c._updateFrame!==e)&&(c._isTrigger=!1,b.length=0)),b.push(m)}c&&a&&(this._currentFrameCollisions.push(c),c._setUpdateFrame(e))}}_eventScripts(){for(var t=i.Stat.loopCount,e=0,s=this._currentFrameCollisions.length;e<s;e++){var o=this._currentFrameCollisions[e],r=o._colliderA,a=o._colliderB;if(!r.destroyed&&!a.destroyed)if(t-o._lastUpdateFrame==1){var n=r.owner,l=n._scripts;if(l)if(o._isTrigger){if(n._needProcessTriggers)for(var _=0,h=l.length;_<h;_++)l[_].onTriggerStay(a)}else if(n._needProcessCollisions)for(_=0,h=l.length;_<h;_++)o.other=a,l[_].onCollisionStay(o);var c=a.owner,b=c._scripts;if(b)if(o._isTrigger){if(c._needProcessTriggers)for(_=0,h=b.length;_<h;_++)b[_].onTriggerStay(r)}else if(c._needProcessCollisions)for(_=0,h=b.length;_<h;_++)o.other=r,b[_].onCollisionStay(o)}else{if(l=(n=r.owner)._scripts)if(o._isTrigger){if(n._needProcessTriggers)for(_=0,h=l.length;_<h;_++)l[_].onTriggerEnter(a)}else if(n._needProcessCollisions)for(_=0,h=l.length;_<h;_++)o.other=a,l[_].onCollisionEnter(o);if(b=(c=a.owner)._scripts)if(o._isTrigger){if(c._needProcessTriggers)for(_=0,h=b.length;_<h;_++)b[_].onTriggerEnter(r)}else if(c._needProcessCollisions)for(_=0,h=b.length;_<h;_++)o.other=r,b[_].onCollisionEnter(o)}}for(e=0,s=this._previousFrameCollisions.length;e<s;e++){var d=this._previousFrameCollisions[e],u=d._colliderA,C=d._colliderB;if(!u.destroyed&&!C.destroyed&&t-d._updateFrame==1){if(this._collisionsUtils.recoverCollision(d),l=(n=u.owner)._scripts)if(d._isTrigger){if(n._needProcessTriggers)for(_=0,h=l.length;_<h;_++)l[_].onTriggerExit(C)}else if(n._needProcessCollisions)for(_=0,h=l.length;_<h;_++)d.other=C,l[_].onCollisionExit(d);if(b=(c=C.owner)._scripts)if(d._isTrigger){if(c._needProcessTriggers)for(_=0,h=b.length;_<h;_++)b[_].onTriggerExit(u)}else if(c._needProcessCollisions)for(_=0,h=b.length;_<h;_++)d.other=u,b[_].onCollisionExit(d)}}for(var y in this._currentConstraint){var m=this._currentConstraint[y],p=m.owner._scripts;if(m.enabled&&m._isBreakConstrained()&&p&&0!=p.length)for(e=0,s=p.length;e<s;e++)p[e].onJointBreak()}}clearForces(){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_clearForces(this._btDiscreteDynamicsWorld)}}g.PHYSICSENGINEFLAGS_NONE=0,g.PHYSICSENGINEFLAGS_COLLISIONSONLY=1,g.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT=2,g.PHYSICSENGINEFLAGS_MULTITHREADED=4,g.PHYSICSENGINEFLAGS_USEHARDWAREWHENPOSSIBLE=8,g.SOLVERMODE_RANDMIZE_ORDER=1,g.SOLVERMODE_FRICTION_SEPARATE=2,g.SOLVERMODE_USE_WARMSTARTING=4,g.SOLVERMODE_USE_2_FRICTION_DIRECTIONS=16,g.SOLVERMODE_ENABLE_FRICTION_DIRECTION_CACHING=32,g.SOLVERMODE_DISABLE_VELOCITY_DEPENDENT_FRICTION_DIRECTION=64,g.SOLVERMODE_CACHE_FRIENDLY=128,g.SOLVERMODE_SIMD=256,g.SOLVERMODE_INTERLEAVE_CONTACT_AND_FRICTION_CONSTRAINTS=512,g.SOLVERMODE_ALLOW_ZERO_LENGTH_FRICTION_DIRECTIONS=1024,g.HITSRAYRESULTCALLBACK_FLAG_NONE=0,g.HITSRAYRESULTCALLBACK_FLAG_FILTERBACKFACESS=1,g.HITSRAYRESULTCALLBACK_FLAG_KEEPUNFILIPPEDNORMAL=2,g.HITSRAYRESULTCALLBACK_FLAG_USESUBSIMPLEXCONVEXCASTRAYTEST=4,g.HITSRAYRESULTCALLBACK_FLAG_USEGJKCONVEXCASTRAYTEST=8,g.HITSRAYRESULTCALLBACK_FLAG_TERMINATOR=4294967295,g._tempVector30=new i.Vector3,g.disableSimulation=!1;class T extends m{constructor(t=i.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,e=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER){super(t,e),this._isKinematic=!1,this._mass=1,this._gravity=new i.Vector3(0,-10,0),this._angularDamping=0,this._linearDamping=0,this._overrideGravity=!1,this._totalTorque=new i.Vector3(0,0,0),this._totalForce=new i.Vector3(0,0,0),this._linearVelocity=new i.Vector3,this._angularVelocity=new i.Vector3,this._linearFactor=new i.Vector3(1,1,1),this._angularFactor=new i.Vector3(1,1,1),this._detectCollisions=!0,this._controlBySimulation=!0}static __init__(){var t=i.ILaya3D.Physics3D._bullet;T._btTempVector30=t.btVector3_create(0,0,0),T._btTempVector31=t.btVector3_create(0,0,0),T._btVector3Zero=t.btVector3_create(0,0,0),T._btInertia=t.btVector3_create(0,0,0),T._btImpulse=t.btVector3_create(0,0,0),T._btImpulseOffset=t.btVector3_create(0,0,0),T._btGravity=t.btVector3_create(0,0,0),T._btTransform0=t.btTransform_create()}get mass(){return this._mass}set mass(t){t=Math.max(t,1e-7),this._mass=t,this._isKinematic||this._updateMass(t)}get isKinematic(){return this._isKinematic}set isKinematic(t){this._isKinematic=t,this._controlBySimulation=!t;var e=i.ILaya3D.Physics3D._bullet,s=!!(this._simulation&&this._enabled&&this._colliderShape);s&&this._removeFromSimulation();var o=this._btColliderObject,r=e.btCollisionObject_getCollisionFlags(o);t?(r|=h.COLLISIONFLAGS_KINEMATIC_OBJECT,e.btCollisionObject_setCollisionFlags(o,r),e.btCollisionObject_forceActivationState(this._btColliderObject,h.ACTIVATIONSTATE_DISABLE_DEACTIVATION),this._enableProcessCollisions=!1,this._updateMass(0)):((r&h.COLLISIONFLAGS_KINEMATIC_OBJECT)>0&&(r^=h.COLLISIONFLAGS_KINEMATIC_OBJECT),e.btCollisionObject_setCollisionFlags(o,r),e.btCollisionObject_setActivationState(this._btColliderObject,h.ACTIVATIONSTATE_ACTIVE_TAG),this._enableProcessCollisions=!0,this._updateMass(this._mass));var a=T._btVector3Zero;e.btCollisionObject_setInterpolationLinearVelocity(o,a),e.btRigidBody_setLinearVelocity(o,a),e.btCollisionObject_setInterpolationAngularVelocity(o,a),e.btRigidBody_setAngularVelocity(o,a),s&&this._addToSimulation()}get linearDamping(){return this._linearDamping}set linearDamping(t){this._linearDamping=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,t,this._angularDamping)}get angularDamping(){return this._angularDamping}set angularDamping(t){this._angularDamping=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,this._linearDamping,t)}get overrideGravity(){return this._overrideGravity}set overrideGravity(t){this._overrideGravity=t;var e=i.ILaya3D.Physics3D._bullet;if(this._btColliderObject){var s=e.btRigidBody_getFlags(this._btColliderObject);t?0==(s&T._BT_DISABLE_WORLD_GRAVITY)&&e.btRigidBody_setFlags(this._btColliderObject,s|T._BT_DISABLE_WORLD_GRAVITY):(s&T._BT_DISABLE_WORLD_GRAVITY)>0&&e.btRigidBody_setFlags(this._btColliderObject,s^T._BT_DISABLE_WORLD_GRAVITY)}}get gravity(){var t=i.ILaya3D.Physics3D._bullet;return T._btGravity=t.btRigidBody_getGravity(this._btColliderObject),i.Utils3D._convertToLayaVec3(T._btGravity,this._gravity,!0),this._gravity}set gravity(t){this._gravity=t;var e=i.ILaya3D.Physics3D._bullet;e.btVector3_setValue(T._btGravity,-t.x,t.y,t.z),e.btRigidBody_setGravity(this._btColliderObject,T._btGravity)}get totalForce(){if(this._btColliderObject){var t=i.ILaya3D.Physics3D._bullet.btRigidBody_getTotalForce(this._btColliderObject);return i.Utils3D._convertToLayaVec3(t,this._totalForce,!0),this._totalForce}return null}get linearFactor(){return this._linearFactor}set linearFactor(t){this._linearFactor=t;var e=T._btTempVector30;i.Utils3D._convertToBulletVec3(t,e,!1),i.ILaya3D.Physics3D._bullet.btRigidBody_setLinearFactor(this._btColliderObject,e)}get linearVelocity(){return this._btColliderObject&&i.Utils3D._convertToLayaVec3(i.ILaya3D.Physics3D._bullet.btRigidBody_getLinearVelocity(this._btColliderObject),this._linearVelocity,!0),this._linearVelocity}set linearVelocity(t){if(this._linearVelocity=t,this._btColliderObject){var e=T._btTempVector30;i.Utils3D._convertToBulletVec3(t,e,!0),this.isSleeping&&this.wakeUp(),i.ILaya3D.Physics3D._bullet.btRigidBody_setLinearVelocity(this._btColliderObject,e)}}get angularFactor(){return this._angularFactor}set angularFactor(t){this._angularFactor=t;var e=T._btTempVector30;i.Utils3D._convertToBulletVec3(t,e,!1),i.ILaya3D.Physics3D._bullet.btRigidBody_setAngularFactor(this._btColliderObject,e)}get angularVelocity(){return this._btColliderObject&&i.Utils3D._convertToLayaVec3(i.ILaya3D.Physics3D._bullet.btRigidBody_getAngularVelocity(this._btColliderObject),this._angularVelocity,!0),this._angularVelocity}set angularVelocity(t){if(this._angularVelocity=t,this._btColliderObject){var e=T._btTempVector30;i.Utils3D._convertToBulletVec3(t,e,!0),this.isSleeping&&this.wakeUp(),i.ILaya3D.Physics3D._bullet.btRigidBody_setAngularVelocity(this._btColliderObject,e)}}get totalTorque(){if(this._btColliderObject){var t=i.ILaya3D.Physics3D._bullet.btRigidBody_getTotalTorque(this._btColliderObject);return i.Utils3D._convertToLayaVec3(t,this._totalTorque,!0),this._totalTorque}return null}get detectCollisions(){return this._detectCollisions}set detectCollisions(t){this._detectCollisions!==t&&(this._detectCollisions=t,this._colliderShape&&this._enabled&&this._simulation&&(this._simulation._removeRigidBody(this),this._simulation._addRigidBody(this,this._collisionGroup,t?this._canCollideWith:0)))}get isSleeping(){return!!this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_getActivationState(this._btColliderObject)===h.ACTIVATIONSTATE_ISLAND_SLEEPING}get sleepLinearVelocity(){return i.ILaya3D.Physics3D._bullet.btRigidBody_getLinearSleepingThreshold(this._btColliderObject)}set sleepLinearVelocity(t){var e=i.ILaya3D.Physics3D._bullet;e.btRigidBody_setSleepingThresholds(this._btColliderObject,t,e.btRigidBody_getAngularSleepingThreshold(this._btColliderObject))}get sleepAngularVelocity(){return i.ILaya3D.Physics3D._bullet.btRigidBody_getAngularSleepingThreshold(this._btColliderObject)}set sleepAngularVelocity(t){var e=i.ILaya3D.Physics3D._bullet;e.btRigidBody_setSleepingThresholds(this._btColliderObject,e.btRigidBody_getLinearSleepingThreshold(this._btColliderObject),t)}get btColliderObject(){return this._btColliderObject}set constaintRigidbodyA(t){this._constaintRigidbodyA=t}get constaintRigidbodyA(){return this._constaintRigidbodyA}set constaintRigidbodyB(t){this._constaintRigidbodyB=t}get constaintRigidbodyB(){return this._constaintRigidbodyB}_updateMass(t){if(this._btColliderObject&&this._colliderShape){var e=i.ILaya3D.Physics3D._bullet;e.btCollisionShape_calculateLocalInertia(this._colliderShape._btShape,t,T._btInertia),e.btRigidBody_setMassProps(this._btColliderObject,t,T._btInertia),e.btRigidBody_updateInertiaTensor(this._btColliderObject)}}_onScaleChange(t){super._onScaleChange(t),this._updateMass(this._isKinematic?0:this._mass)}_derivePhysicsTransformation(t){var e=i.ILaya3D.Physics3D._bullet,s=this._btColliderObject,o=e.btCollisionObject_getWorldTransform(s),r=T._btTransform0;e.btTransform_equal(r,o),this._innerDerivePhysicsTransformation(r,t),e.btRigidBody_setCenterOfMassTransform(s,r)}_onAdded(){var t=i.ILaya3D.Physics3D._bullet,e=t.layaMotionState_create();t.layaMotionState_set_rigidBodyID(e,this._id),this._btLayaMotionState=e;var s=t.btRigidBodyConstructionInfo_create(0,e,null,T._btVector3Zero),o=t.btRigidBody_create(s);t.btCollisionObject_setUserIndex(o,this.id),this._btColliderObject=o,super._onAdded(),this.mass=this._mass,this.linearFactor=this._linearFactor,this.angularFactor=this._angularFactor,this.linearDamping=this._linearDamping,this.angularDamping=this._angularDamping,this.overrideGravity=this._overrideGravity,this.gravity=this._gravity,this.isKinematic=this._isKinematic,t.btRigidBodyConstructionInfo_destroy(s)}_onEnable(){super._onEnable(),this._constaintRigidbodyA&&this._constaintRigidbodyA.connectedBody._simulation&&(this._constaintRigidbodyA._createConstraint(),this._constaintRigidbodyA._onEnable()),this._constaintRigidbodyB&&this._constaintRigidbodyB.ownBody._simulation&&(this._constaintRigidbodyB._createConstraint(),this._constaintRigidbodyB._onEnable())}_onShapeChange(t){if(super._onShapeChange(t),this._isKinematic)this._updateMass(0);else{var e=i.ILaya3D.Physics3D._bullet;e.btRigidBody_setCenterOfMassTransform(this._btColliderObject,e.btCollisionObject_getWorldTransform(this._btColliderObject)),this._updateMass(this._mass)}}_parse(t){if(null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),null!=t.mass&&(this.mass=t.mass),null!=t.linearDamping&&(this.linearDamping=t.linearDamping),null!=t.angularDamping&&(this.angularDamping=t.angularDamping),null!=t.overrideGravity&&(this.overrideGravity=t.overrideGravity),null!=t.linearFactor){var i=this.linearFactor;i.fromArray(t.linearFactor),this.linearFactor=i}if(null!=t.angularFactor){var e=this.angularFactor;e.fromArray(t.angularFactor),this.angularFactor=e}if(t.gravity){var s=this.gravity;s.fromArray(t.gravity),this.gravity=s}super._parse(t),this._parseShape(t.shapes),null!=t.isKinematic&&(this.isKinematic=t.isKinematic)}_onDestroy(){i.ILaya3D.Physics3D._bullet.btMotionState_destroy(this._btLayaMotionState),super._onDestroy(),this._btLayaMotionState=null,this._gravity=null,this._totalTorque=null,this._linearVelocity=null,this._angularVelocity=null,this._linearFactor=null,this._angularFactor=null,this.constaintRigidbodyA&&this.constaintRigidbodyA._breakConstrained(),this.constaintRigidbodyB&&(this.constaintRigidbodyB.connectedBody=null,this.constaintRigidbodyB._onDisable())}_addToSimulation(){this._simulation._addRigidBody(this,this._collisionGroup,this._detectCollisions?this._canCollideWith:0)}_removeFromSimulation(){this._simulation._removeRigidBody(this)}_cloneTo(t){super._cloneTo(t);var i=t;i.isKinematic=this._isKinematic,i.mass=this._mass,i.gravity=this._gravity,i.angularDamping=this._angularDamping,i.linearDamping=this._linearDamping,i.overrideGravity=this._overrideGravity,i.linearVelocity=this._linearVelocity,i.angularVelocity=this._angularVelocity,i.linearFactor=this._linearFactor,i.angularFactor=this._angularFactor,i.detectCollisions=this._detectCollisions}applyForce(t,e=null){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var s=i.ILaya3D.Physics3D._bullet,o=T._btTempVector30;if(s.btVector3_setValue(o,-t.x,t.y,t.z),e){var r=T._btTempVector31;s.btVector3_setValue(r,-e.x,e.y,e.z),s.btRigidBody_applyForce(this._btColliderObject,o,r)}else s.btRigidBody_applyCentralForce(this._btColliderObject,o)}applyTorque(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=i.ILaya3D.Physics3D._bullet,s=T._btTempVector30;e.btVector3_setValue(s,-t.x,t.y,t.z),e.btRigidBody_applyTorque(this._btColliderObject,s)}applyImpulse(t,e=null){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var s=i.ILaya3D.Physics3D._bullet;s.btVector3_setValue(T._btImpulse,-t.x,t.y,t.z),e?(s.btVector3_setValue(T._btImpulseOffset,-e.x,e.y,e.z),s.btRigidBody_applyImpulse(this._btColliderObject,T._btImpulse,T._btImpulseOffset)):s.btRigidBody_applyCentralImpulse(this._btColliderObject,T._btImpulse)}applyTorqueImpulse(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=i.ILaya3D.Physics3D._bullet,s=T._btTempVector30;e.btVector3_setValue(s,-t.x,t.y,t.z),e.btRigidBody_applyTorqueImpulse(this._btColliderObject,s)}wakeUp(){this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_activate(this._btColliderObject,!1)}clearForces(){var t=this._btColliderObject;if(null==t)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=i.ILaya3D.Physics3D._bullet;e.btRigidBody_clearForces(t);var s=T._btVector3Zero;e.btCollisionObject_setInterpolationLinearVelocity(t,s),e.btRigidBody_setLinearVelocity(t,s),e.btCollisionObject_setInterpolationAngularVelocity(t,s),e.btRigidBody_setAngularVelocity(t,s)}}T.TYPE_STATIC=0,T.TYPE_DYNAMIC=1,T.TYPE_KINEMATIC=2,T._BT_DISABLE_WORLD_GRAVITY=1,T._BT_ENABLE_GYROPSCOPIC_FORCE=2;class S extends i.Component{constructor(t){super(),this._anchor=new i.Vector3,this._connectAnchor=new i.Vector3,this._feedbackEnabled=!1,this._getJointFeedBack=!1,this._currentForce=new i.Vector3,this._currentTorque=new i.Vector3,this._constraintType=t;var e=i.Physics3D._bullet;this._btframATrans=e.btTransform_create(),this._btframBTrans=e.btTransform_create(),e.btTransform_setIdentity(this._btframATrans),e.btTransform_setIdentity(this._btframBTrans),this._btframAPos=e.btVector3_create(0,0,0),this._btframBPos=e.btVector3_create(0,0,0),e.btTransform_setOrigin(this._btframATrans,this._btframAPos),e.btTransform_setOrigin(this._btframBTrans,this._btframBPos),this._breakForce=-1,this._breakTorque=-1}get enabled(){return super.enabled}set enabled(t){super.enabled=t}get appliedImpulse(){return this._feedbackEnabled||(this._btConstraint.EnableFeedback(!0),this._feedbackEnabled=!0),this._btConstraint.AppliedImpulse}set connectedBody(t){this._connectedBody=t,t&&(t.constaintRigidbodyB=this)}get connectedBody(){return this._connectedBody}get ownBody(){return this._ownBody}set ownBody(t){this._ownBody=t,t.constaintRigidbodyA=this}get currentForce(){return this._getJointFeedBack||this._getFeedBackInfo(),this._currentForce}get currentTorque(){return this._getJointFeedBack||this._getFeedBackInfo(),this._currentTorque}get breakForce(){return this._breakForce}set breakForce(t){this._breakForce=t}get breakTorque(){return this._breakTorque}set breakTorque(t){this._breakTorque=t}set anchor(t){t.cloneTo(this._anchor),this.setFrames()}get anchor(){return this._anchor}set connectAnchor(t){t.cloneTo(this._connectAnchor),this.setFrames()}get connectAnchor(){return this._connectAnchor}setOverrideNumSolverIterations(t){i.Physics3D._bullet.btTypedConstraint_setOverrideNumSolverIterations(this._btConstraint,t)}setConstraintEnabled(t){i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,t)}_onEnable(){super._onEnable(),this.enabled=!0}_onDisable(){super._onDisable(),this.enabled=!1}setFrames(){var t=i.Physics3D._bullet;t.btVector3_setValue(this._btframAPos,-this._anchor.x,this.anchor.y,this.anchor.z),t.btVector3_setValue(this._btframBPos,-this._connectAnchor.x,this._connectAnchor.y,this._connectAnchor.z),t.btTransform_setOrigin(this._btframATrans,this._btframAPos),t.btTransform_setOrigin(this._btframBTrans,this._btframBPos)}_addToSimulation(){}_removeFromSimulation(){}_createConstraint(){}setConnectRigidBody(t,i){var e=t&&!!(t._simulation&&t._enabled&&t.colliderShape),s=i&&!!(i._simulation&&i._enabled&&i.colliderShape);if(!e||!s)throw"ownerRigid or connectRigidBody is not in Simulation";t==this._ownBody&&i==this._connectedBody||(!(!this.enabled||!this._simulation)&&this._removeFromSimulation(),this._ownBody=t,this._connectedBody=i,this._ownBody.constaintRigidbodyA=this,this._connectedBody.constaintRigidbodyB=this,this._createConstraint())}getcurrentForce(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var e=i.Physics3D._bullet,s=e.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj);t.setValue(e.btVector3_x(s),e.btVector3_y(s),e.btVector3_z(s))}getcurrentTorque(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var e=i.Physics3D._bullet,s=e.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);t.setValue(e.btVector3_x(s),e.btVector3_y(s),e.btVector3_z(s))}_onDestroy(){var t=i.Physics3D._bullet;this._simulation&&this._removeFromSimulation(),this._btConstraint&&this._btJointFeedBackObj&&this._simulation&&(t.btTypedConstraint_destroy(this._btConstraint),t.btJointFeedback_destroy(this._btJointFeedBackObj),this._btJointFeedBackObj=null,this._btConstraint=null),super._onDisable()}_isBreakConstrained(){if(this._getJointFeedBack=!1,-1==this.breakForce&&-1==this.breakTorque)return!1;this._getFeedBackInfo();var t=-1!=this._breakForce&&i.Vector3.scalarLength(this._currentForce)>this._breakForce,e=-1!=this._breakTorque&&i.Vector3.scalarLength(this._currentTorque)>this._breakTorque;return!(!t&&!e)&&(this._breakConstrained(),!0)}_parse(t){this._anchor.fromArray(t.anchor),this._connectAnchor.fromArray(t.connectAnchor),this.setFrames()}_getFeedBackInfo(){var t=i.Physics3D._bullet,e=t.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj),s=t.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);this._currentTorque.setValue(t.btVector3_x(s),t.btVector3_y(s),t.btVector3_z(s)),this._currentForce.setValue(t.btVector3_x(e),t.btVector3_y(e),t.btVector3_z(e)),this._getJointFeedBack=!0}_breakConstrained(){this.ownBody.constaintRigidbodyA=null,this.connectedBody&&(this.connectedBody.constaintRigidbodyB=null),this.destroy()}}S.CONSTRAINT_POINT2POINT_CONSTRAINT_TYPE=3,S.CONSTRAINT_HINGE_CONSTRAINT_TYPE=4,S.CONSTRAINT_CONETWIST_CONSTRAINT_TYPE=5,S.CONSTRAINT_D6_CONSTRAINT_TYPE=6,S.CONSTRAINT_SLIDER_CONSTRAINT_TYPE=7,S.CONSTRAINT_CONTACT_CONSTRAINT_TYPE=8,S.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE=9,S.CONSTRAINT_GEAR_CONSTRAINT_TYPE=10,S.CONSTRAINT_FIXED_CONSTRAINT_TYPE=11,S.CONSTRAINT_MAX_CONSTRAINT_TYPE=12,S.CONSTRAINT_CONSTRAINT_ERP=1,S.CONSTRAINT_CONSTRAINT_STOP_ERP=2,S.CONSTRAINT_CONSTRAINT_CFM=3,S.CONSTRAINT_CONSTRAINT_STOP_CFM=4,S.tempForceV3=new i.Vector3;class I extends S{constructor(){super(S.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE),this._axis=new i.Vector3,this._secondaryAxis=new i.Vector3,this._minLinearLimit=new i.Vector3,this._maxLinearLimit=new i.Vector3,this._minAngularLimit=new i.Vector3,this._maxAngularLimit=new i.Vector3,this._linearLimitSpring=new i.Vector3,this._angularLimitSpring=new i.Vector3,this._linearBounce=new i.Vector3,this._angularBounce=new i.Vector3,this._linearDamp=new i.Vector3,this._angularDamp=new i.Vector3,this._xMotion=0,this._yMotion=0,this._zMotion=0,this._angularXMotion=0,this._angularYMotion=0,this._angularZMotion=0;var t=i.Physics3D._bullet;this._btAxis=t.btVector3_create(-1,0,0),this._btSecondaryAxis=t.btVector3_create(0,1,0)}get axis(){return this._axis}get secondaryAxis(){return this._secondaryAxis}set maxAngularLimit(t){t.cloneTo(this._maxAngularLimit)}set minAngularLimit(t){t.cloneTo(this._minAngularLimit)}get maxAngularLimit(){return this._maxAngularLimit}get minAngularLimit(){return this._minAngularLimit}set maxLinearLimit(t){t.cloneTo(this._maxLinearLimit)}set minLinearLimit(t){t.cloneTo(this._minLinearLimit)}get maxLinearLimit(){return this._maxLinearLimit}get minLinearLimit(){return this._minLinearLimit}set XMotion(t){this._xMotion!=t&&(this._xMotion=t,this.setLimit(I.MOTION_LINEAR_INDEX_X,t,-this._maxLinearLimit.x,-this._minLinearLimit.x))}get XMotion(){return this._xMotion}set YMotion(t){this._yMotion!=t&&(this._yMotion=t,this.setLimit(I.MOTION_LINEAR_INDEX_Y,t,this._minLinearLimit.y,this._maxLinearLimit.y))}get YMotion(){return this._yMotion}set ZMotion(t){this._zMotion!=t&&(this._zMotion=t,this.setLimit(I.MOTION_LINEAR_INDEX_Z,t,this._minLinearLimit.z,this._maxLinearLimit.z))}get ZMotion(){return this._zMotion}set angularXMotion(t){this._angularXMotion!=t&&(this._angularXMotion=t,this.setLimit(I.MOTION_ANGULAR_INDEX_X,t,-this._maxAngularLimit.x,-this._minAngularLimit.x))}get angularXMotion(){return this._angularXMotion}set angularYMotion(t){this._angularYMotion!=t&&(this._angularYMotion=t,this.setLimit(I.MOTION_ANGULAR_INDEX_Y,t,this._minAngularLimit.y,this._maxAngularLimit.y))}get angularYMotion(){return this._angularYMotion}set angularZMotion(t){this._angularZMotion!=t&&(this._angularZMotion=t,this.setLimit(I.MOTION_ANGULAR_INDEX_Z,t,this._minAngularLimit.z,this._maxAngularLimit.z))}get angularZMotion(){return this._angularZMotion}set linearLimitSpring(t){i.Vector3.equals(this._linearLimitSpring,t)||(t.cloneTo(this._linearLimitSpring),this.setSpring(I.MOTION_LINEAR_INDEX_X,t.x),this.setSpring(I.MOTION_LINEAR_INDEX_Y,t.y),this.setSpring(I.MOTION_LINEAR_INDEX_Z,t.z))}get linearLimitSpring(){return this._linearLimitSpring}set angularLimitSpring(t){i.Vector3.equals(this._angularLimitSpring,t)||(t.cloneTo(this._angularLimitSpring),this.setSpring(I.MOTION_ANGULAR_INDEX_X,t.x),this.setSpring(I.MOTION_ANGULAR_INDEX_Y,t.y),this.setSpring(I.MOTION_ANGULAR_INDEX_Z,t.z))}get angularLimitSpring(){return this._angularLimitSpring}set linearBounce(t){i.Vector3.equals(this._linearBounce,t)||(t.cloneTo(this._linearBounce),this.setBounce(I.MOTION_LINEAR_INDEX_X,t.x),this.setBounce(I.MOTION_LINEAR_INDEX_Y,t.y),this.setBounce(I.MOTION_LINEAR_INDEX_Z,t.z))}get linearBounce(){return this._linearBounce}set angularBounce(t){i.Vector3.equals(this._angularBounce,t)||(t.cloneTo(this._angularBounce),this.setBounce(I.MOTION_ANGULAR_INDEX_X,t.x),this.setBounce(I.MOTION_ANGULAR_INDEX_Y,t.y),this.setBounce(I.MOTION_ANGULAR_INDEX_Z,t.z))}get angularBounce(){return this._angularBounce}set linearDamp(t){i.Vector3.equals(this._linearDamp,t)||(t.cloneTo(this._linearDamp),this.setDamping(I.MOTION_LINEAR_INDEX_X,t.x),this.setDamping(I.MOTION_LINEAR_INDEX_Y,t.y),this.setDamping(I.MOTION_LINEAR_INDEX_Z,t.z))}get linearDamp(){return this._linearDamp}set angularDamp(t){i.Vector3.equals(this._angularDamp,t)||(t.cloneTo(this._angularDamp),this.setDamping(I.MOTION_ANGULAR_INDEX_X,t.x),this.setDamping(I.MOTION_ANGULAR_INDEX_Y,t.y),this.setDamping(I.MOTION_ANGULAR_INDEX_Z,t.z))}get angularDamp(){return this._angularDamp}set anchor(t){t.cloneTo(this._anchor),this.setFrames()}get anchor(){return this._anchor}set connectAnchor(t){t.cloneTo(this._connectAnchor),this.setFrames()}get connectAnchor(){return this._connectAnchor}setAxis(t,e){if(this._btConstraint){var s=i.Physics3D._bullet;this._axis.setValue(t.x,t.y,t.y),this._secondaryAxis.setValue(e.x,e.y,e.z),this._btAxis=s.btVector3_setValue(-t.x,t.y,t.z),this._btSecondaryAxis=s.btVector3_setValue(-e.x,e.y,e.z),s.btGeneric6DofSpring2Constraint_setAxis(this._btConstraint,this._btAxis,this._btSecondaryAxis)}}setLimit(t,e,s,o){if(this._btConstraint){var r=i.Physics3D._bullet;switch(e){case I.CONFIG_MOTION_TYPE_LOCKED:r.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,0,0);break;case I.CONFIG_MOTION_TYPE_LIMITED:s<o&&r.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,s,o);break;case I.CONFIG_MOTION_TYPE_FREE:r.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,1,0);break;default:throw"No Type of Axis Motion"}}}setSpring(t,e,s=!0){if(this._btConstraint){var o=i.Physics3D._bullet,r=e>0;o.btGeneric6DofSpring2Constraint_enableSpring(this._btConstraint,t,r),r&&o.btGeneric6DofSpring2Constraint_setStiffness(this._btConstraint,t,e,s)}}setBounce(t,e){this._btConstraint&&(e=e<=0?0:e,i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setBounce(this._btConstraint,t,e))}setDamping(t,e,s=!0){this._btConstraint&&(e=e<=0?0:e,i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setDamping(this._btConstraint,t,e,s))}setEquilibriumPoint(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setEquilibriumPoint(this._btConstraint,t,e)}enableMotor(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_enableMotor(this._btConstraint,t,e)}setServo(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setServo(this._btConstraint,t,e)}setTargetVelocity(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setTargetVelocity(this._btConstraint,t,e)}setTargetPosition(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setServoTarget(this._btConstraint,t,e)}setMaxMotorForce(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setMaxMotorForce(this._btConstraint,t,e)}setParam(t,e,s){i.Physics3D._bullet.btTypedConstraint_setParam(this._btConstraint,t,e,s)}setFrames(){super.setFrames();var t=i.Physics3D._bullet;this._btConstraint&&t.btGeneric6DofSpring2Constraint_setFrames(this._btConstraint,this._btframATrans,this._btframBTrans)}_addToSimulation(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}_removeFromSimulation(){this._simulation.removeConstraint(this),this._simulation=null}_createConstraint(){var t=i.Physics3D._bullet;this._btConstraint=t.btGeneric6DofSpring2Constraint_create(this.ownBody.btColliderObject,this._btframAPos,this.connectedBody.btColliderObject,this._btframBPos,I.RO_XYZ),this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint),t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj),this._simulation=this.owner._scene.physicsSimulation,this._initAllConstraintInfo(),this._addToSimulation(),i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0)}_initAllConstraintInfo(){this.setLimit(I.MOTION_LINEAR_INDEX_X,this._xMotion,-this._maxLinearLimit.x,-this._minLinearLimit.x),this.setLimit(I.MOTION_LINEAR_INDEX_Y,this._yMotion,this._minLinearLimit.y,this._maxLinearLimit.y),this.setLimit(I.MOTION_LINEAR_INDEX_Z,this._zMotion,this._minLinearLimit.z,this._maxLinearLimit.z),this.setLimit(I.MOTION_ANGULAR_INDEX_X,this._angularXMotion,-this._maxAngularLimit.x,-this._minAngularLimit.x),this.setLimit(I.MOTION_ANGULAR_INDEX_Y,this._angularYMotion,this._minAngularLimit.y,this._maxAngularLimit.y),this.setLimit(I.MOTION_ANGULAR_INDEX_Z,this._angularZMotion,this._minAngularLimit.z,this._maxAngularLimit.z),this.setSpring(I.MOTION_LINEAR_INDEX_X,this._linearLimitSpring.x),this.setSpring(I.MOTION_LINEAR_INDEX_Y,this._linearLimitSpring.y),this.setSpring(I.MOTION_LINEAR_INDEX_Z,this._linearLimitSpring.z),this.setSpring(I.MOTION_ANGULAR_INDEX_X,this._angularLimitSpring.x),this.setSpring(I.MOTION_ANGULAR_INDEX_Y,this._angularLimitSpring.y),this.setSpring(I.MOTION_ANGULAR_INDEX_Z,this._angularLimitSpring.z),this.setBounce(I.MOTION_LINEAR_INDEX_X,this._linearBounce.x),this.setBounce(I.MOTION_LINEAR_INDEX_Y,this._linearBounce.y),this.setBounce(I.MOTION_LINEAR_INDEX_Z,this._linearBounce.z),this.setBounce(I.MOTION_ANGULAR_INDEX_X,this._angularBounce.x),this.setBounce(I.MOTION_ANGULAR_INDEX_Y,this._angularBounce.y),this.setBounce(I.MOTION_ANGULAR_INDEX_Z,this._angularBounce.z),this.setDamping(I.MOTION_LINEAR_INDEX_X,this._linearDamp.x),this.setDamping(I.MOTION_LINEAR_INDEX_Y,this._linearDamp.y),this.setDamping(I.MOTION_LINEAR_INDEX_Z,this._linearDamp.z),this.setDamping(I.MOTION_ANGULAR_INDEX_X,this._angularDamp.x),this.setDamping(I.MOTION_ANGULAR_INDEX_Y,this._angularDamp.y),this.setDamping(I.MOTION_ANGULAR_INDEX_Z,this._angularDamp.z),this.setFrames(),this.setEquilibriumPoint(0,0)}_onAdded(){super._onAdded()}_onEnable(){this._btConstraint&&(super._onEnable(),this._btConstraint&&i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0))}_onDisable(){super._onDisable(),!this.connectedBody&&this._simulation&&this._removeFromSimulation(),this._btConstraint&&i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!1)}_parse(t,i=null){super._parse(t),this._axis.fromArray(t.axis),this._secondaryAxis.fromArray(t.secondaryAxis);var e=t.linearLimit;this._minLinearLimit.setValue(-e,-e,-e),this._maxLinearLimit.setValue(e,e,e);var s=t.linearLimitSpring;this._linearLimitSpring.setValue(s,s,s);var o=t.linearLimitDamper;this._linearDamp.setValue(o,o,o);var r=t.linearLimitBounciness;this._linearBounce.setValue(r,r,r);var a=t.lowAngularXLimit,n=t.highAngularXLimit,l=t.angularYLimit,_=t.angularZLimit;this._minAngularLimit.setValue(a,-l,-_),this._maxAngularLimit.setValue(n,l,_);var h=t.highAngularXLimitBounciness,c=t.angularYLimitBounciness,b=t.angularZLimitBounciness;this._angularBounce.setValue(h,c,b);var d=t.angularXLimitSpring,u=t.angularYZLimitSpring;this._angularLimitSpring.setValue(d,u,u);var C=t.angularXLimitDamper,y=t.angularYZLimitDamper;this._angularDamp.setValue(C,y,y),this.XMotion=t.xMotion,this.YMotion=t.yMotion,this.ZMotion=t.zMotion,this.angularXMotion=t.angularXMotion,this.angularYMotion=t.angularYMotion,this.angularZMotion=t.angularZMotion,-1!=t.rigidbodyID&&-1!=t.connectRigidbodyID&&(i.component.push(this),i.data.push(t)),null!=t.breakForce&&(this.breakForce=t.breakForce),null!=t.breakTorque&&(this.breakTorque=t.breakTorque)}_parseInteractive(t=null,i=null){var e=i[t.rigidbodyID].getComponent(T),s=i[t.connectRigidbodyID].getComponent(T);this.ownBody=e,this.connectedBody=s}_onDestroy(){super._onDestroy()}}I.CONFIG_MOTION_TYPE_LOCKED=0,I.CONFIG_MOTION_TYPE_LIMITED=1,I.CONFIG_MOTION_TYPE_FREE=2,I.MOTION_LINEAR_INDEX_X=0,I.MOTION_LINEAR_INDEX_Y=1,I.MOTION_LINEAR_INDEX_Z=2,I.MOTION_ANGULAR_INDEX_X=3,I.MOTION_ANGULAR_INDEX_Y=4,I.MOTION_ANGULAR_INDEX_Z=5,I.RO_XYZ=0,I.RO_XZY=1,I.RO_YXZ=2,I.RO_YZX=3,I.RO_ZXY=4,I.RO_ZYX=5;class O extends e{constructor(t,s){super(),this._normal=t,this._offset=s,this._type=e.SHAPETYPES_STATICPLANE;var o=i.ILaya3D.Physics3D._bullet;o.btVector3_setValue(O._btNormal,-t.x,t.y,t.z),this._btShape=o.btStaticPlaneShape_create(O._btNormal,s)}static __init__(){O._btNormal=i.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}clone(){var t=new O(this._normal,this._offset);return this.cloneTo(t),t}}t.BoxColliderShape=s,t.BulletInteractive=c,t.CapsuleColliderShape=o,t.CharacterController=b,t.ColliderShape=e,t.Collision=d,t.CollisionTool=y,t.CompoundColliderShape=r,t.ConeColliderShape=a,t.ConfigurableConstraint=I,t.Constraint3D=class{constructor(){}},t.ConstraintComponent=S,t.ContactPoint=u,t.CylinderColliderShape=n,t.FixedConstraint=class extends S{constructor(){super(S.CONSTRAINT_FIXED_CONSTRAINT_TYPE),this.breakForce=-1,this.breakTorque=-1}_addToSimulation(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}_removeFromSimulation(){this._simulation.removeConstraint(this),this._simulation=null}_createConstraint(){if(this.ownBody&&this.ownBody._simulation&&this.connectedBody&&this.connectedBody._simulation){var t=i.Physics3D._bullet;this._btConstraint=t.btFixedConstraint_create(this.ownBody.btColliderObject,this._btframATrans,this.connectedBody.btColliderObject,this._btframBTrans),this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint),t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj),this._simulation=this.owner._scene.physicsSimulation,this._addToSimulation(),i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0)}}_onAdded(){super._onAdded()}_onEnable(){this._btConstraint&&(super._onEnable(),this._btConstraint&&i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0))}_onDisable(){super._onDisable(),this.connectedBody||this._removeFromSimulation(),this._btConstraint&&i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!1)}_onDestroy(){super._onDestroy()}_parse(t,i=null){super._parse(t),-1!=t.rigidbodyID&&-1!=t.connectRigidbodyID&&(i.component.push(this),i.data.push(t)),null!=t.breakForce&&(this.breakForce=t.breakForce),null!=t.breakTorque&&(this.breakTorque=t.breakTorque)}_parseInteractive(t=null,i=null){var e=i[t.rigidbodyID].getComponent(T),s=i[t.connectRigidbodyID].getComponent(T);this.ownBody=e,this.connectedBody=s}},t.HitResult=C,t.MeshColliderShape=l,t.PhysicsCollider=class extends m{constructor(t=i.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,e=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER){super(t,e),this._enableProcessCollisions=!1}_addToSimulation(){this._simulation._addPhysicsCollider(this,this._collisionGroup,this._canCollideWith)}_removeFromSimulation(){this._simulation._removePhysicsCollider(this)}_parse(t){null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),super._parse(t),this._parseShape(t.shapes)}_onAdded(){var t=i.Physics3D._bullet,e=t.btCollisionObject_create();t.btCollisionObject_setUserIndex(e,this.id),t.btCollisionObject_forceActivationState(e,h.ACTIVATIONSTATE_DISABLE_SIMULATION);var s=t.btCollisionObject_getCollisionFlags(e);this.owner.isStatic?((s&h.COLLISIONFLAGS_KINEMATIC_OBJECT)>0&&(s^=h.COLLISIONFLAGS_KINEMATIC_OBJECT),s|=h.COLLISIONFLAGS_STATIC_OBJECT):((s&h.COLLISIONFLAGS_STATIC_OBJECT)>0&&(s^=h.COLLISIONFLAGS_STATIC_OBJECT),s|=h.COLLISIONFLAGS_KINEMATIC_OBJECT),t.btCollisionObject_setCollisionFlags(e,s),this._btColliderObject=e,super._onAdded()}},t.PhysicsComponent=h,t.PhysicsSettings=class{constructor(){this.flags=0,this.maxSubSteps=1,this.fixedTimeStep=1/60}},t.PhysicsSimulation=g,t.PhysicsTriggerComponent=m,t.PhysicsUpdateList=p,t.Rigidbody3D=T,t.SphereColliderShape=_,t.StaticPlaneColliderShape=O}(window.Laya=window.Laya||{},Laya);